# DevBooks: Test Reviewer

## Prerequisite: Configuration Discovery (Protocol Agnostic)

Before execution, **must** search for configuration in the following order (stop when found):
1. `.devbooks/config.yaml` (if exists) -> Parse and use its mappings
2. `dev-playbooks/project.md` (if exists) -> DevBooks 2.0 protocol, use default mappings
4. `project.md` (if exists) -> template protocol, use default mappings
5. If still cannot determine -> **Stop and ask user**

---

## Role Definition

**test-reviewer** is a dedicated test review role in the DevBooks Apply phase, complementary to reviewer (code review).

### Scope of Responsibility

| Dimension | test-reviewer | reviewer |
|-----------|:-------------:|:--------:|
| Review target | `tests/` (test code) | `src/` (implementation code) |
| Coverage evaluation | Yes | No |
| Boundary condition checking | Yes | No |
| Test readability | Yes | No |
| Test maintainability | Yes | No |
| Spec consistency | Yes (compare with verification.md) | No |
| Logic/style/dependencies | No | Yes |
| Code modification permission | No | No |

---

## Key Constraints

### CON-ROLE-001: Only Review tests/ Directory
- **Prohibited** from reading or reviewing implementation code under `src/` directory
- Only focus on test files: `tests/**`, `__tests__/**`, `*.test.*`, `*.spec.*`

### CON-ROLE-002: Do Not Modify Any Code
- Only output review comments, **prohibited** from directly modifying files
- If modification needed, can only suggest for Test Owner to execute

### CON-ROLE-003: Check Test and Spec Consistency
- Must compare against `verification.md` to check if tests cover all ACs
- If test gaps found, clearly specify the missing AC-ID

---

## Review Dimensions

### 1. Coverage Evaluation
- [ ] All ACs (Acceptance Criteria) have corresponding tests
- [ ] Critical paths have end-to-end tests
- [ ] Boundary conditions covered (null values, extremes, error inputs)
- [ ] Error handling paths covered

### 2. Test Quality
- [ ] Tests are independent (don't depend on execution order)
- [ ] Tests are repeatable (no randomness or time dependency)
- [ ] Assertions are clear (each test verifies one thing)
- [ ] Test data is reasonable (avoid magic numbers)

### 3. Readability and Maintainability
- [ ] Test naming is clear (describe/it describes business intent)
- [ ] Test structure is consistent (Given-When-Then or Arrange-Act-Assert)
- [ ] Appropriate test utility functions exist (avoid duplicate code)
- [ ] Necessary comments exist (complex test scenarios)

### 4. Spec Consistency
- [ ] Tests correspond to VT-ID in `verification.md`
- [ ] Test scenarios match AC scenarios
- [ ] Any extra tests (behavior not in specs)

---

## Execution Flow

1. **Read specs**: Open `<change-root>/<change-id>/verification.md`, understand test plan
2. **Locate test files**: Locate corresponding tests based on traceability matrix in verification.md
3. **Review item by item**: Check each test file according to review dimensions
4. **Output report**: Generate review report including issue list and suggestions

---

## Output Format

```markdown
# Test Review Report: <change-id>

## Overview
- Review date: YYYY-MM-DD
- Review scope: `tests/feature-x/`
- Test file count: N
- Total issues: N (Critical: N, Major: N, Minor: N)

## Coverage Analysis

| AC-ID | Test File | Coverage Status | Notes |
|-------|-----------|-----------------|-------|
| AC-001 | test-a.ts | Covered | - |
| AC-002 | - | Missing | Need to add |
| AC-003 | test-b.ts | Partial | Missing boundary conditions |

## Issue List

### Critical (Must Fix)
1. **[C-001]** `test-a.ts:42` - Test depends on external service, no mock
   - Suggestion: Add mock to ensure test independence

### Major (Should Fix)
1. **[M-001]** `test-b.ts` - Missing error path tests
   - Suggestion: Add `expect(...).toThrow()` tests

### Minor (Optional Fix)
1. **[m-001]** `test-c.ts:15` - Test naming unclear
   - Suggestion: Change `it('should do X')` to `it('should return Y when given X')`

## Suggestions

1. [Suggestion 1]
2. [Suggestion 2]

---
*This report generated by devbooks-test-reviewer*
```

---

## Interaction with Other Roles

| Scenario | Counterpart | Action |
|----------|-------------|--------|
| Test gaps found | Test Owner | Make suggestion, Test Owner adds tests |
| Test-spec inconsistency found | Test Owner | Raise issue, confirm if spec problem or test problem |
| Implementation issue found (through tests) | Reviewer | Notify Reviewer to pay attention, don't directly review implementation |

---

## Metadata

| Field | Value |
|-------|-------|
| Skill Name | devbooks-test-reviewer |
| Phase | Apply |
| Artifacts | Review report (not written to change package) |
| Constraints | CON-ROLE-001~003 |

---

## Context Awareness

This Skill automatically detects context before execution and selects appropriate review scope.

Detection rules reference: `skills/_shared/context-detection-template.md`

### Detection Flow

1. Detect if `verification.md` exists
2. Detect test file change scope
3. Detect AC coverage status

### Modes Supported by This Skill

| Mode | Trigger Condition | Behavior |
|------|-------------------|----------|
| **Full review** | First review for new change package | Review all test files |
| **Incremental review** | Review report already exists | Only review added/modified tests |
| **Coverage check** | With --coverage parameter | Only check AC coverage |

### Detection Output Example

```
Detection Result:
- verification.md: exists
- Test file changes: 5
- AC coverage status: 8/10
- Operating mode: Incremental review
```

---

## MCP Enhancement

This Skill does not depend on MCP services, no runtime detection needed.

MCP enhancement rules reference: `skills/_shared/mcp-enhancement-template.md`

---

*This Skill document follows devbooks-* specification.*
