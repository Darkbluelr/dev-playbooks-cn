# 测试运行策略

## 测试分层标签

| 标签 | 用途 | Coder 何时运行 | 预期耗时 |
|------|------|----------------|----------|
| `@smoke` | 快速反馈，核心路径 | 每次代码修改后 | 秒级 |
| `@critical` | 关键功能验证 | 准备提交前 | 分钟级 |
| `@full` | 完整验收测试 | **不运行**，触发 CI 异步执行 | 可以慢 |

## Coder 的测试运行策略

```bash
# 开发过程中：频繁运行 @smoke
npm test -- --grep "@smoke"

# 准备提交前：运行 @critical
npm test -- --grep "@smoke|@critical"

# 提交后：CI 自动运行 @full（Coder 不等待）
git push  # 触发 CI
# → Coder 可以开始下一个任务
```

## 异步与同步的边界

| 动作 | 阻塞/异步 | 说明 |
|------|-----------|------|
| `@smoke` 测试 | 同步 | 每次修改后立即运行 |
| `@critical` 测试 | 同步 | 提交前必须通过 |
| `@full` 测试 | **异步** | CI 后台运行，不阻塞 Coder |
| 开始下一个变更 | **不阻塞** | Coder 可以立即开始 |
| 归档 | **阻塞** | 必须等 @full 通过 |

## 核心原则

> **关键**：Coder 只运行快轨测试，@full 测试异步触发，不阻塞开发迭代。

### Coder 完成后的流程

1. **快轨测试绿**：`@smoke` + `@critical` 通过
2. **触发 @full**：提交代码，CI 开始异步运行 @full 测试
3. **状态变更**：设置变更状态为 `Implementation Done`
4. **可以开始下一个变更**（不阻塞）
5. **等待 @full 结果**：
   - @full 通过 → Test Owner 进入阶段 2 审计证据
   - @full 失败 → Coder 修复

**关键提醒**：
- Coder 完成后，状态是 `Implementation Done`，**不是直接进入 Code Review**
- 开发迭代是异步的（可以开始下一个变更），但归档是同步的（必须等 @full 通过）
