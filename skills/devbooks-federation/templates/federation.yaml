# DevBooks 跨仓库联邦配置模板
# 用途：定义多仓库项目的依赖关系和分析边界
#
# 安装方式：
#   cp this-file .devbooks/federation.yaml
#   # 或
#   cp this-file dev-playbooks/federation.yaml
#
# 使用方式：
#   - devbooks-impact-analysis 会自动检测此文件并分析跨仓边界
#   - guardrail-check.sh --check-federation 会验证联邦约束

# 联邦配置版本
version: "1.0"

# 当前仓库信息
current:
  name: "my-service"
  type: "service"  # service | library | shared | monorepo-package
  owner: "team-a"

# 上游依赖（我依赖的仓库）
upstreams:
  - name: "shared-types"
    repo: "org/shared-types"
    # 可选：指定依赖的具体模块或 API
    contracts:
      - "src/types/user.ts"
      - "src/types/order.ts"
    # 版本约束
    version: "^2.0.0"
    # 变更通知配置
    notify_on_change: true

  - name: "auth-sdk"
    repo: "org/auth-sdk"
    contracts:
      - "src/client.ts"
    version: ">=1.5.0"

# 下游消费者（依赖我的仓库）
downstreams:
  - name: "web-app"
    repo: "org/web-app"
    # 我暴露给它的契约
    contracts:
      - "src/api/v1/**"
      - "src/events/published.ts"

  - name: "mobile-app"
    repo: "org/mobile-app"
    contracts:
      - "src/api/v1/**"

# 联邦规则
rules:
  # 契约变更规则
  contract_change:
    # 需要通知下游的变更类型
    notify_types:
      - breaking    # 破坏性变更
      - deprecation # 废弃通知
    # 通知方式
    notify_channels:
      - github_issue  # 在下游仓库创建 Issue
      - slack         # 发送 Slack 通知（需配置 webhook）

  # 版本兼容性
  compatibility:
    # 最少支持的历史版本数
    min_supported_versions: 2
    # 废弃到移除的最短周期（天）
    deprecation_period_days: 30

  # 影响分析边界
  impact_analysis:
    # 分析深度（跨几个仓库）
    max_depth: 2
    # 是否包含测试代码
    include_tests: false

# 本地开发配置（可选）
local_dev:
  # 本地仓库路径映射
  paths:
    shared-types: "../shared-types"
    auth-sdk: "../auth-sdk"
  # 是否使用本地 link
  use_local_links: true
