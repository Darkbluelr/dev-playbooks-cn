# verification.md 增强模板

Test Owner 必须产出结构化的 `verification.md`，同时作为测试计划和追溯文档。

## Status 字段权限

| 状态 | 含义 | 谁可以设置 |
|------|------|-----------|
| `Draft` | 初始状态 | 自动生成 |
| `Ready` | 测试计划就绪 | **Test Owner** |
| `Implementation Done` | 实现完成，等待 @full 测试 | **Coder** |
| `Verified` | @full 通过 + 证据审计完成 | **Test Owner** |
| `Done` | Review 通过 | Reviewer（禁止 Test Owner/Coder） |
| `Archived` | 已归档 | Archiver |

**关键约束**：
- `Verified` 状态要求 @full 测试必须已通过
- 只有 `Verified` 或 `Done` 状态的变更才能归档
- Test Owner 完成测试计划后设 `Ready`，完成证据审计后设 `Verified`

## 完整模板

```markdown
# 验证计划：<change-id>

## 测试策略

### 测试类型分布
| 测试类型 | 数量 | 用途 | 预期耗时 |
|----------|------|------|----------|
| 单元测试 | X | 核心逻辑、边界条件 | < 5s |
| 集成测试 | Y | API 契约、数据流 | < 30s |
| E2E 测试 | Z | 关键用户路径 | < 60s |
| 契约测试 | W | 外部 API 兼容性 | < 10s |

### 测试环境
| 测试类型 | 环境 | 依赖 |
|----------|------|------|
| 单元 | Node.js | 无（全部 mock） |
| 集成 | Node.js + 测试数据库 | Docker |
| E2E | 浏览器（Playwright） | 完整应用 |

---

## AC 覆盖矩阵

| AC-ID | 描述 | 测试类型 | Test ID | 优先级 | 状态 |
|-------|------|----------|---------|--------|------|
| AC-001 | 用户登录返回 JWT | 单元 | T-001 | P0 | [ ] |
| AC-002 | 密码错误返回 401 | 单元 | T-002 | P0 | [ ] |
| AC-003 | Token 24小时后过期 | 集成 | T-003 | P1 | [ ] |

**覆盖摘要**：
- AC 总数：X
- 已有测试覆盖：Y
- 覆盖率：Y/X = Z%

---

## 边界条件检查清单

### 输入验证
- [ ] 空输入 / null 值
- [ ] 超过最大长度
- [ ] 无效格式（邮箱、手机号等）
- [ ] SQL 注入 / XSS 尝试

### 状态边界
- [ ] 第一项（index 0）
- [ ] 最后一项（index n-1）
- [ ] 空集合
- [ ] 单元素集合
- [ ] 最大容量

### 并发与时序
- [ ] 并发访问同一资源
- [ ] 请求超时处理
- [ ] 竞态条件场景
- [ ] 失败后重试

### 错误处理
- [ ] 网络故障
- [ ] 数据库连接丢失
- [ ] 外部 API 不可用
- [ ] 无效响应格式

---

## 测试优先级

| 优先级 | 定义 | Red 基线要求 |
|--------|------|--------------|
| P0 | 阻塞发布，核心功能 | 必须在 Red 基线中失败 |
| P1 | 重要，应该覆盖 | 应该在 Red 基线中失败 |
| P2 | 锦上添花，可以后补 | Red 基线中可选 |

### P0 测试（必须在 Red 基线中）
1. T-001: <测试描述>
2. T-002: <测试描述>

### P1 测试（应该在 Red 基线中）
1. T-003: <测试描述>

---

## 手动验证检查清单

### MANUAL-001: <手动检查描述>
- [ ] 步骤 1
- [ ] 步骤 2
- [ ] 预期结果

---

## 追溯矩阵

| 需求 | 设计 (AC) | 测试 | 证据 |
|------|-----------|------|------|
| REQ-001 | AC-001, AC-002 | T-001, T-002 | evidence/red-baseline/*.log |
```

## verification.md 必须包含的测试分层信息

```markdown
## 测试分层策略

| 类型 | 数量 | 覆盖场景 | 预期执行时间 |
|------|------|----------|--------------|
| 单元测试 | X | AC-001, AC-002 | < Ys |
| 集成测试 | Y | AC-003 | < Zs |
| E2E 测试 | Z | 关键路径 | < Ws |

## 测试环境要求

| 测试类型 | 运行环境 | 依赖 |
|----------|----------|------|
| 单元测试 | Node.js | 无外部依赖 |
| 集成测试 | Node.js + 测试数据库 | Docker |
| E2E 测试 | Browser (Playwright) | 完整应用 |
```
