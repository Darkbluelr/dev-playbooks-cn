# DevBooks Skills 渐进披露改进建议

## 问题诊断

### 当前状态
- ✅ 已采用多文件结构（SKILL.md + references/ + scripts/）
- ⚠️ SKILL.md过长（最长633行，超出官方建议的500行）
- ⚠️ 核心指令与详细规则混在一起

### 官方最佳实践要求
1. SKILL.md < 500行
2. 核心信息在SKILL.md，详细参考在单独文件
3. 引用保持一层深（SKILL.md → reference.md，不要 A → B → C）
4. 脚本可执行但不加载到上下文

## 改进方案

### 方案1：拆分超长SKILL.md（推荐）

**目标**：将633行的 `devbooks-test-owner/SKILL.md` 拆分为：

```
devbooks-test-owner/
├── SKILL.md (< 200行)           # 概览 + 导航 + 核心流程
├── references/
│   ├── 测试驱动.md               # 已存在
│   ├── 测试分层策略.md           # 已存在
│   ├── 测试代码提示词.md         # 已存在
│   ├── 禁令与规则.md             # 新增：从SKILL.md移出的详细规则
│   ├── 测试模式与标签.md         # 新增：@smoke/@critical/@full详解
│   └── 证据审计清单.md           # 新增：阶段2审计步骤详解
└── scripts/
    └── evidence-check.sh         # 可选：自动化证据检查脚本
```

**SKILL.md 精简后的结构**：
```markdown
---
name: devbooks-test-owner
description: ...
---

# DevBooks：测试负责人（Test Owner）

## 快速开始（Quick Start）

我的职责：
1. 阶段1：编写测试 → 产出Red基线
2. 阶段2：审计证据 → 勾选AC矩阵

## 核心流程

[保留最核心的流程图和步骤，约50-100行]

## 详细参考（按需阅读）

- **必读**：`~/.claude/skills/_shared/references/通用守门协议.md`
- **禁令与规则**：`references/禁令与规则.md`（包含所有❌禁止项）
- **测试方法论**：`references/测试驱动.md`
- **测试分层**：`references/测试分层策略.md`
- **完整提示词**：`references/测试代码提示词.md`
- **证据审计**：`references/证据审计清单.md`（阶段2必读）

## 常见场景

[保留3-5个最常见的场景示例，每个<10行]

## 自检清单

- [ ] 阶段1：Red基线已产出？
- [ ] 阶段2：@full测试已通过？
- [ ] AC矩阵已勾选？
```

### 方案2：标准化引用格式

在所有SKILL.md中统一使用以下格式：

```markdown
## 📚 参考文档

### 必读（自动加载）
- `~/.claude/skills/_shared/references/通用守门协议.md`

### 按需阅读（需要时再读）
- **方法论**：`references/测试驱动.md` - 完整TDD方法论
- **分层策略**：`references/测试分层策略.md` - @smoke/@critical/@full详解
- **详细规则**：`references/禁令与规则.md` - 所有禁止项和边界条件

### 工具脚本（执行不加载）
```bash
# 检查证据完整性
bash scripts/evidence-check.sh <change-id>
```
```

### 方案3：增加"渐进披露检查"脚本

创建一个脚本来检查所有skills是否符合渐进披露原则：

```bash
#!/bin/bash
# scripts/check-progressive-disclosure.sh

echo "检查 Skills 渐进披露合规性..."

for skill in skills/devbooks-*/SKILL.md; do
  lines=$(wc -l < "$skill")
  skill_name=$(basename $(dirname "$skill"))

  if [ "$lines" -gt 500 ]; then
    echo "❌ $skill_name: $lines 行（超出建议的500行）"
  elif [ "$lines" -gt 400 ]; then
    echo "⚠️  $skill_name: $lines 行（接近上限）"
  else
    echo "✅ $skill_name: $lines 行"
  fi
done
```

## 实施优先级

### P0（立即执行）
1. 拆分 `devbooks-test-owner/SKILL.md`（633行 → <300行）
2. 拆分 `devbooks-delivery-workflow/SKILL.md`（488行 → <300行）
3. 拆分 `devbooks-coder/SKILL.md`（480行 → <300行）

### P1（下个版本）
1. 标准化所有skills的引用格式
2. 为每个skill添加"快速开始"章节
3. 创建渐进披露检查脚本

### P2（持续优化）
1. 监控SKILL.md行数，防止膨胀
2. 定期审查references/目录结构
3. 收集AI使用反馈，优化引用路径

## 预期收益

1. **性能提升**：SKILL.md更小 → 加载更快 → AI响应更快
2. **上下文节省**：详细文档按需加载 → 节省token → 可以同时使用更多skills
3. **可维护性**：职责清晰 → 更新更容易 → 减少冲突
4. **用户体验**：快速开始 → 降低学习曲线 → 提高采用率
