# DevBooks 定位与集成指南

> DevBooks 是一套上下文管理协议，可与任意 AI 编程工具搭配使用

---

## 目录

1. [DevBooks 是什么](#devbooks-是什么)
2. [DevBooks 不是什么](#devbooks-不是什么)
3. [支持的编程工具](#支持的编程工具)
4. [推荐 MCP 工具](#推荐-mcp-工具)
5. [编程工具集成建议](#编程工具集成建议)
6. [架构分层](#架构分层)

---

## DevBooks 是什么

DevBooks 是一套**上下文管理协议**，专注于解决 AI 辅助编程中的三大核心问题：

| 问题 | DevBooks 的解决方案 |
|------|-------------------|
| AI 自评"已完成"但实际有问题 | 证据驱动：完成由测试和构建结果定义 |
| AI 自己写测试自己通过 | 角色隔离：Test Owner 与 Coder 独立对话 |
| 规格散落在聊天记录中 | 真理源管理：规格写入项目，可追溯可验证 |

### 核心职责

```
DevBooks 负责的事情（上下文管理协议）
├── 规范驱动开发 (Spec-Driven Development)
├── 角色隔离 (Role Separation)
├── 证据驱动完成 (Evidence-Driven Completion)
├── 真理源管理 (Truth Source Management)
├── 变更闭环 (Change Loop)
├── 质量闸门 (Quality Gates)
└── MCP 工具推荐 (Curated MCP Recommendations)
```

### 核心价值

1. **协议优先**：真理/变更/归档写进项目，不只存在聊天记录
2. **锚点优先**：完成由测试、静态分析、构建和证据定义
3. **角色隔离**：Test Owner 与 Coder 必须在独立对话中工作
4. **真理源分离**：`<truth-root>` 只读真理；`<change-root>` 临时工作区
5. **结构守门**：优先关注复杂度/耦合/测试质量

---

## DevBooks 不是什么

DevBooks **不是编程工具**，不负责以下功能（这些由编程工具提供）：

```
编程工具负责的事情（非 DevBooks 职责）
├── 多模型路由与调度
├── 令牌监控与上下文压缩
├── 后台任务管理与并行执行
├── 会话恢复与状态持久化
├── LSP/语言服务器集成
├── AST 解析与代码智能
├── 钩子系统与生命周期管理
└── 模型参数调优
```

### 为什么这样划分？

| 层级 | 职责 | 变化频率 | 示例 |
|------|------|---------|------|
| **编程工具层** | 执行能力 | 快速迭代 | 新模型支持、性能优化 |
| **协议层 (DevBooks)** | 工程规范 | 相对稳定 | 角色隔离、证据驱动 |

DevBooks 保持协议层的稳定性，让用户可以自由选择和切换编程工具，而不需要重新学习工程规范。

---

## 支持的编程工具

DevBooks 可以与以下 AI 编程工具搭配使用：

### 完整支持（Skills 系统）

| 编程工具 | 配置文件 | 集成方式 |
|----------|---------|---------|
| Claude Code | `CLAUDE.md` | 21 个 Skills |
| Codex CLI | `AGENTS.md` | 代理指令格式 |
| Qoder | `AGENTS.md` | 代理指令格式 |

### Rules 系统支持

| 编程工具 | 配置目录 | 说明 |
|----------|---------|------|
| Cursor | `.cursor/rules/` | 自定义规则 |
| Windsurf | `.windsurf/rules/` | 自定义规则 |
| Continue | `.continue/rules/` | 自定义规则 |

### 基础支持

| 编程工具 | 配置文件 | 说明 |
|----------|---------|------|
| GitHub Copilot | `.github/copilot-instructions.md` | 有限支持 |
| 其他工具 | `AGENTS.md` / `README.md` | 作为上下文参考 |

---

## 推荐 MCP 工具

DevBooks 维护一份经过筛选的 MCP 工具推荐清单，帮助用户在任何支持 MCP 的编程工具上获得最佳体验。

### 推荐清单

| MCP | 类型 | 主要用途 | 与 DevBooks 工作流的结合 |
|-----|------|---------|------------------------|
| **context7** | 文档获取 | 实时获取库文档和代码示例 | Design/Coder 阶段查询 API |
| **ckb** | 代码分析 | 符号搜索、引用查找、影响分析 | Impact Analysis 增强 |
| **tree-sitter-mcp** | 语义搜索 | 实时代码解析、AST 查询 | 快速代码搜索 |
| **github** | 平台集成 | 仓库/Issues/PR 管理 | Review/Archive 阶段 |
| **playwright** | 浏览器自动化 | 网页测试、爬取、交互 | E2E 测试验证 |
| **websearch** | 网络搜索 | 查找技术方案、API 文档 | Proposal/Design 阶段 |
| **grep_app** | 代码搜索 | GitHub 公共仓库代码搜索 | 找参考实现、学习模式 |
| **task-master** | 任务管理 | AI 驱动的任务管理 | 任务跟踪（可选） |

### 新增推荐：websearch

**用途**：在网络上搜索最新的技术方案、API 变更、社区讨论。

**配置**：
```json
{
  "mcpServers": {
    "websearch": {
      "command": "npx",
      "args": ["-y", "@anthropic-ai/exa-mcp"],
      "env": {
        "EXA_API_KEY": "your-api-key"
      }
    }
  }
}
```

**与 DevBooks 工作流的结合**：

| 阶段 | 用途 |
|------|------|
| Proposal | 搜索类似问题的解决方案，验证需求合理性 |
| Design | 查找架构模式、最佳实践、技术选型参考 |
| Spec | 查询 API 设计的行业惯例 |
| Review | 验证方案是否符合社区标准 |

### 新增推荐：grep_app

**用途**：在 GitHub 公共仓库中搜索代码模式，找参考实现。

**配置**：
```json
{
  "mcpServers": {
    "grep_app": {
      "command": "npx",
      "args": ["-y", "grep-app-mcp"]
    }
  }
}
```

**与 DevBooks 工作流的结合**：

| 阶段 | 用途 |
|------|------|
| Design | 找类似功能的开源实现作为设计参考 |
| Spec | 查找契约定义的行业惯例 |
| Coder | 学习高质量代码的写法，找实现模式 |
| Review | 对比开源项目的实现方式 |

### MCP 分类

```
核心推荐（强烈建议配置）
├── context7     → 文档查询
├── ckb          → 代码理解
└── github       → 平台集成

增强推荐（提升效率）
├── websearch    → 网络搜索
├── grep_app     → 代码搜索
├── tree-sitter  → 语义分析
└── playwright   → 浏览器自动化

可选推荐（按需配置）
└── task-master  → 任务管理
```

---

## 编程工具集成建议

以下是 DevBooks 对编程工具开发者的建议。如果你的编程工具实现了这些能力，与 DevBooks 的配合会更顺畅。

### 建议能力 1：任务完成保障

**问题**：AI 容易在任务未完成时声称"已完成"

**建议实现**：
- 检测 `tasks.md` 中的 `[ ]` 未完成项
- 在用户声称"已完成"时提示未完成的任务
- 可选：阻止在任务未完成时结束会话

**与 DevBooks 的配合**：
- DevBooks 的 `tasks.md` 是任务清单的标准格式
- 编程工具的任务检测 + DevBooks 的 `task-completion-check.sh` 闸门 = 双重保障

### 建议能力 2：断点续做

**问题**：长任务会话中断后，需要从头开始

**建议实现**：
- 持久化当前工作状态到本地文件
- 会话恢复时自动加载状态
- 从中断点继续，而不是重新开始

**与 DevBooks 的配合**：
- DevBooks 的 `tasks.md` 使用 `[x]` / `[ ]` 标记进度
- 编程工具读取 `tasks.md`，识别最后一个 `[x]` 后的第一个 `[ ]`
- 从该任务继续执行

### 建议能力 3：工作模式识别

**问题**：不同任务需要不同的处理方式

**建议实现**：
- 检测用户输入中的关键字
- 根据关键字调整工作模式

**示例关键字**：

| 关键字 | 建议行为 |
|--------|---------|
| `high-risk` | 触发更严格的审查流程 |
| `prototype` | 启用原型模式，放宽部分约束 |
| `strict` | 启用全部质量闸门 |
| `quick` | 跳过非必要步骤 |

**与 DevBooks 的配合**：
- `high-risk` → 触发 `devbooks-proposal-challenger` + `devbooks-proposal-judge`
- `prototype` → 使用 `change-scaffold.sh --prototype`
- `strict` → 启用所有闸门检查

### 建议能力 4：角色隔离支持

**问题**：同一会话中 AI 既写测试又写代码，容易自证

**建议实现**：
- 支持会话/对话隔离
- 或至少支持"角色切换"时清除部分上下文

**与 DevBooks 的配合**：
- DevBooks 的 GIP-01 要求 Test Owner 和 Coder 在独立对话中工作
- 编程工具的会话隔离能力使这一要求更容易实现

---

## 架构分层

```
┌─────────────────────────────────────────────────────────────────┐
│                           用户                                  │
└─────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                     编程工具（可选择）                           │
│                                                                 │
│   任意支持 MCP 和 Skills/Rules 的 AI 编程工具                    │
│                                                                 │
│   职责：模型调度、令牌管理、会话恢复、LSP 集成、并行执行...       │
└─────────────────────────────────────────────────────────────────┘
                               │
                          加载 DevBooks
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                  DevBooks (上下文管理协议)                       │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                     21 个 Skills                         │   │
│   │                                                          │   │
│   │  Proposal → Design → Plan → Test → Code → Review → Archive │  │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                     核心协议                             │   │
│   │                                                          │   │
│   │   • 角色隔离      • 证据驱动      • 真理源管理            │   │
│   │   • 变更闭环      • 质量闸门      • 宪法约束              │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                   推荐 MCP 工具                          │   │
│   │                                                          │   │
│   │   context7 │ ckb │ websearch │ grep_app │ github │ ...  │   │
│   └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                         项目代码库                              │
│                                                                 │
│   dev-playbooks/                                                │
│   ├── constitution.md    # 宪法                                 │
│   ├── project.md         # 项目上下文                           │
│   ├── specs/             # 真理源                               │
│   └── changes/           # 变更工作区                           │
└─────────────────────────────────────────────────────────────────┘
```

### 层级职责

| 层级 | 职责 | 稳定性 | 示例产物 |
|------|------|--------|---------|
| **用户** | 提出需求 | - | 自然语言需求 |
| **编程工具** | 执行能力 | 快速迭代 | 代码生成、模型调用 |
| **DevBooks** | 工程规范 | 相对稳定 | Skills、闸门、协议 |
| **项目代码库** | 业务实现 | 按需变更 | 源代码、规格、文档 |

### 交互流程

```
1. 用户通过【编程工具】发起请求
2. 【编程工具】加载【DevBooks】Skills 和规则
3. 【DevBooks】引导工作流（Proposal → ... → Archive）
4. 【编程工具】调用【MCP 工具】增强能力
5. 产物写入【项目代码库】
6. 【DevBooks】闸门验证
7. 归档到真理源
```

---

## 快速开始

### 1. 安装 DevBooks

```bash
npm install -g dev-playbooks-cn
dev-playbooks-cn init
```

### 2. 配置推荐 MCP

编辑 `~/.claude.json`（或对应编程工具的配置文件）：

```json
{
  "mcpServers": {
    "context7": {
      "command": "npx",
      "args": ["-y", "@upstash/context7-mcp"]
    },
    "ckb": {
      "command": "/usr/local/bin/ckb",
      "args": ["mcp"]
    },
    "websearch": {
      "command": "npx",
      "args": ["-y", "@anthropic-ai/exa-mcp"],
      "env": { "EXA_API_KEY": "your-key" }
    },
    "grep_app": {
      "command": "npx",
      "args": ["-y", "grep-app-mcp"]
    },
    "github": {
      "command": "docker",
      "args": ["run", "-i", "--rm", "-e", "GITHUB_PERSONAL_ACCESS_TOKEN", "ghcr.io/github/github-mcp-server"],
      "env": { "GITHUB_PERSONAL_ACCESS_TOKEN": "your-token" }
    }
  }
}
```

### 3. 开始使用

```
我想添加一个新功能：用户登录。
请使用 devbooks-router 帮我规划工作流。
```

---

## 参考资料

- [DevBooks 配置指南](./DevBooks配置指南.md)
- [推荐 MCP 详细配置](./推荐MCP.md)
- [Skills 使用说明](../skills/Skills使用说明.md)
- [宪法原则](../dev-playbooks/constitution.md)

---

**文档版本**：1.0
**更新日期**：2025-01-14
