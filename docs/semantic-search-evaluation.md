# DevBooks 语义搜索方案评估

## 问题定义

Augment 的语义搜索能力：
- 用户输入自然语言问题（如"用户认证流程"）
- 返回语义相关的代码，而不仅仅是关键词匹配

## 可选方案对比

### 方案 A: 本地向量数据库 + Ollama

```
代码 → Ollama Embeddings → ChromaDB/LanceDB → 语义搜索
```

**优点**：
- 完全本地，无 API 费用
- 支持离线使用

**缺点**：
- 需要本地 GPU（否则很慢）
- 初始向量化耗时
- 需要维护额外服务

**可达水平**：60%

### 方案 B: Anthropic API Embeddings

```
代码 → Anthropic Embeddings API → 向量存储 → 语义搜索
```

**优点**：
- 质量高
- 无需本地 GPU

**缺点**：
- 有 API 费用
- 需要网络

**可达水平**：75%

### 方案 C: CKB 图分析替代（当前方案）

```
用户问题 → 关键词提取 → CKB searchSymbols/explainFile → 结果
```

**优点**：
- 无需额外服务
- 利用现有 CKB 能力
- 图关系可补偿语义理解

**缺点**：
- 非真正语义搜索
- 依赖关键词提取质量

**可达水平**：50%

### 方案 D: 混合方案（推荐）

```
用户问题 → 关键词搜索 + CKB 图分析 + LLM 重排序
                              ↓
                      返回最相关结果
```

**实现步骤**：
1. 用 Grep/searchSymbols 获取候选结果
2. 用 CKB 的 explainFile 解释每个文件
3. 让 Claude 对结果进行相关性排序

**优点**：
- 无需向量数据库
- 利用 Claude 自身理解能力
- 实现简单

**可达水平**：65-70%

## 推荐方案

**短期**：采用方案 C + D 混合
- 利用现有 CKB 能力
- 在 `/codebase` 命令中实现 LLM 重排序

**长期**（如果需要更高精度）：
- 方案 B（Anthropic Embeddings）
- 需要：向量数据库 MCP Server

## 实现优先级

1. ✅ 代码片段注入（已完成）
2. ✅ /codebase 指令（已完成）
3. ✅ 后台索引（已完成）
4. ⏳ 语义搜索（建议暂用 CKB 替代）
