# DevBooks 安装提示词

---

## 安装器角色说明

```text
你是"DevBooks 安装器"。你的目标是完成以下组件的安装：

1. OpenSpec 协议集成（创建 .devbooks/config.yaml）
2. DevBooks Skills 安装
3. MCP Server 配置（可选）

安装后效果：
- OpenSpec 工作流可用（/openspec:proposal、/openspec:apply、/openspec:archive）
- DevBooks Skills 可用（devbooks-coder、devbooks-test-owner 等）
- 角色隔离执行（Test Owner / Coder / Reviewer）
```

---

## 第一步：OpenSpec 协议集成

### 前置条件

- 项目已完成 OpenSpec 初始化：存在 `openspec/` 和 `openspec/project.md`

### 创建 `.devbooks/config.yaml`

```yaml
# .devbooks/config.yaml
# DevBooks Protocol Discovery Configuration

protocol: openspec
truth_root: openspec/specs/
change_root: openspec/changes/
agents_doc: openspec/project.md
project_profile: openspec/specs/_meta/project-profile.md

constraints:
  apply_requires_role: true
  apply_roles:
    - test-owner
    - coder
    - reviewer
    - test-reviewer
  role_isolation: true
  coder_no_tests: true
  structural_guardrails: true

proposal:
  enable_debate: true
  require_impact_analysis: true
```

### 更新 CLAUDE.md

在项目根目录的 `CLAUDE.md` 中添加：

```markdown
<!-- OPENSPEC:START -->
# OpenSpec 使用说明

当请求涉及规划、提案、变更时，打开 `@/openspec/AGENTS.md` 了解工作流程。

<!-- OPENSPEC:END -->
```

---

## 第二步：安装 DevBooks Skills + Prompts

```bash
cd <devbooks-project-root>
./scripts/install-skills.sh --with-codex-prompts
```

这会同时安装：
- DevBooks Skills（到 `~/.claude/skills/`）
- Codex Prompts（到 `~/.codex/prompts/`）

如果只需要 Skills（不使用 Codex CLI）：

```bash
./scripts/install-skills.sh
```

---

## 第三步：MCP Server 配置（可选）

编辑 `~/.claude.json`：

```json
{
  "mcpServers": {
    "ckb": {
      "command": "npx",
      "args": ["-y", "@anthropic/ckb-mcp-server@latest"]
    },
    "context7": {
      "command": "npx",
      "args": ["-y", "@anthropic/context7-mcp-server@latest"]
    },
    "task-master": {
      "command": "npx",
      "args": ["-y", "task-master-mcp@latest"]
    }
  }
}
```

---

## 安装完成检查清单

| 检查项 | 验证方法 | 预期结果 |
|--------|----------|---------|
| OpenSpec 配置 | 检查 `.devbooks/config.yaml` | 文件存在且格式正确 |
| Skills | `ls ~/.claude/skills/devbooks-*` | 显示已安装的 Skills |
| Prompts | `ls ~/.codex/prompts/devbooks-*` | 显示已安装的 Prompts（如使用 Codex） |
| MCP CKB | Claude Code 中调用 `mcp__ckb__getStatus` | 显示后端状态 |

---

## 使用说明

### OpenSpec 工作流

```
/openspec:proposal <change-id>  # 创建提案
/openspec:apply <role> <id>     # 执行变更（需指定角色）
/openspec:archive <id>          # 归档变更
```

### 可用角色

| 角色 | 职责 | 禁止操作 |
|------|------|----------|
| test-owner | 产出 verification.md + tests/ | - |
| coder | 按 tasks.md 实现功能 | 禁止修改 tests/ |
| reviewer | 输出评审意见 | 禁止修改代码 |
| test-reviewer | 评审测试质量 | 禁止修改代码 |

### DevBooks Skills

| Skill | 用途 |
|-------|------|
| devbooks-coder | 按计划实现功能 |
| devbooks-test-owner | 编写验收测试 |
| devbooks-router | 路由到合适的 Skill |
| devbooks-proposal-author | 撰写变更提案 |
| devbooks-code-review | 代码评审 |

---

## 故障排除

| 问题 | 解决方案 |
|------|---------|
| /openspec 命令不可用 | 检查 Skills 是否正确安装 |
| 角色检查不生效 | 检查 `.devbooks/config.yaml` 中 `apply_requires_role: true` |
| MCP 连接失败 | 检查 `~/.claude.json` 配置 |
