# Verification: enhance-code-intelligence

---
version: 1.0
status: Red Baseline
owner: Test Owner (AI)
created: 2026-01-08
change_id: enhance-code-intelligence
---

## æµ‹è¯•åˆ†å±‚ç­–ç•¥

| ç±»å‹ | æ•°é‡ | è¦†ç›–åœºæ™¯ | é¢„æœŸæ‰§è¡Œæ—¶é—´ |
|------|------|----------|--------------|
| å•å…ƒæµ‹è¯• | 6 | AC-001, AC-002, AC-003 | < 3s |
| é›†æˆæµ‹è¯• | 2 | AC-004, AC-005 | < 10s |
| E2E æµ‹è¯• | 0 | - | - |

**è¯´æ˜**ï¼šæœ¬æ¬¡å˜æ›´ä¸º Shell è„šæœ¬ï¼Œæµ‹è¯•ä»¥ BATS (Bash Automated Testing System) ä¸ºä¸»ï¼Œæ— éœ€ E2E æµ‹è¯•ã€‚

## æµ‹è¯•ç¯å¢ƒè¦æ±‚

| æµ‹è¯•ç±»å‹ | è¿è¡Œç¯å¢ƒ | ä¾èµ– |
|----------|----------|------|
| å•å…ƒæµ‹è¯• | Bash 4+ | bats-core, jq |
| é›†æˆæµ‹è¯• | Bash 4+ | bats-core, jq, git |

---

## AC è¿½æº¯çŸ©é˜µ

| AC-ID | éªŒæ”¶æ ‡å‡† | æµ‹è¯•ç”¨ä¾‹ | éªŒè¯æ–¹æ³• | è¯æ®è½ç‚¹ |
|-------|----------|----------|----------|----------|
| AC-001 | çƒ­ç‚¹è¾“å‡ºåŒ…å«å¤æ‚åº¦åˆ†æ•° | `test_hotspot_output_includes_complexity` | è„šæœ¬è¾“å‡ºæ£€æŸ¥ | `evidence/hotspot-output.log` |
| AC-002 | å¤æ‚åº¦å·¥å…·ç¼ºå¤±æ—¶é™çº§ | `test_complexity_fallback_no_tools` | éš”ç¦»ç¯å¢ƒæµ‹è¯• | `evidence/fallback.log` |
| AC-003 | æœ¬åœ°ç´¢å¼•æ£€æµ‹æ­£ç¡® | `test_index_detection_*` | æ–‡ä»¶å­˜åœ¨æ€§æµ‹è¯• | `evidence/ckb-hint.log` |
| AC-004 | Hook æ€»æ‰§è¡Œæ—¶é—´ < 5s | `test_hook_performance` | æ€§èƒ½æµ‹è¯• | `evidence/performance.log` |
| AC-005 | 5 æ–‡ä»¶å¤æ‚åº¦è®¡ç®— < 5s | `test_complexity_batch_performance` | æ€§èƒ½åŸºçº¿æµ‹è¯• | `evidence/performance-baseline.log` |

---

## æµ‹è¯•ç”¨ä¾‹è®¾è®¡

### 1. çƒ­ç‚¹ç®—æ³•æµ‹è¯• (AC-001, AC-002)

#### TC-001: çƒ­ç‚¹è¾“å‡ºåŒ…å«å¤æ‚åº¦åˆ†æ•°

**å‰ç½®æ¡ä»¶**ï¼š
- å®‰è£… radon æˆ– scc
- å­˜åœ¨ Git ä»“åº“ä¸”æœ‰è¿‘ 30 å¤©æäº¤

**è¾“å…¥**ï¼š
```json
{"prompt": "åˆ†æçƒ­ç‚¹æ–‡ä»¶"}
```

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ”¥ çƒ­ç‚¹æ–‡ä»¶ï¼š
  ğŸ”¥ file1.py (5 changes, complexity: 12, score: 60)
```

**æ–­è¨€**ï¼š
- è¾“å‡ºåŒ…å« `complexity:` å­—æ®µ
- è¾“å‡ºåŒ…å« `score:` å­—æ®µ
- score = changes Ã— complexity

#### TC-002: å¤æ‚åº¦å·¥å…·ç¼ºå¤±æ—¶é™çº§

**å‰ç½®æ¡ä»¶**ï¼š
- PATH ä¸­æ—  radon/scc/gocyclo
- å­˜åœ¨ Git ä»“åº“

**è¾“å…¥**ï¼š
```json
{"prompt": "åˆ†æçƒ­ç‚¹æ–‡ä»¶"}
```

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ’¡ æç¤ºï¼šå®‰è£…å¤æ‚åº¦å·¥å…·å¯å¢å¼ºçƒ­ç‚¹é¢„æµ‹å‡†ç¡®ç‡
   Python: pip install radon
ğŸ”¥ çƒ­ç‚¹æ–‡ä»¶ï¼š
  ğŸ”¥ file1.py (5 changes)
```

**æ–­è¨€**ï¼š
- è¾“å‡ºåŒ…å«å®‰è£…æç¤º
- çƒ­ç‚¹è¾“å‡ºä¸åŒ…å« `complexity:` å­—æ®µï¼ˆé™çº§åˆ°çº¯é¢‘ç‡ï¼‰
- Hook æ­£å¸¸é€€å‡ºï¼ˆexit 0ï¼‰

### 2. ç´¢å¼•æ£€æµ‹æµ‹è¯• (AC-003)

#### TC-003: æ— ç´¢å¼•æ—¶è¾“å‡ºå¼•å¯¼æç¤º

**å‰ç½®æ¡ä»¶**ï¼š
- æ—  `index.scip`
- æ—  `.git/ckb/`
- æ—  `.devbooks/embeddings/index.tsv`

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ’¡ æç¤ºï¼šå¯å¯ç”¨ CKB åŠ é€Ÿä»£ç åˆ†æ
   è¿è¡Œï¼š/devbooks-index-bootstrap
```

#### TC-004: æœ‰ SCIP ç´¢å¼•æ—¶æ˜¾ç¤ºå¯ç”¨

**å‰ç½®æ¡ä»¶**ï¼š
- å­˜åœ¨ `index.scip` æ–‡ä»¶

**é¢„æœŸè¾“å‡º**ï¼š
```
âœ… SCIP ç´¢å¼•å¯ç”¨
```

#### TC-005: æœ‰ CKB ç¼“å­˜æ—¶æ˜¾ç¤ºå¯ç”¨

**å‰ç½®æ¡ä»¶**ï¼š
- å­˜åœ¨ `.git/ckb/` ç›®å½•

**é¢„æœŸè¾“å‡º**ï¼š
```
âœ… CKB ç´¢å¼•å¯ç”¨
```

### 3. æ€§èƒ½æµ‹è¯• (AC-004, AC-005)

#### TC-006: Hook æ€»æ‰§è¡Œæ—¶é—´

**æµ‹è¯•æ–¹æ³•**ï¼š
```bash
time ./augment-context-global.sh <<< '{"prompt": "test"}'
```

**é€šè¿‡æ ‡å‡†**ï¼šreal < 5.0s

#### TC-007: å¤æ‚åº¦æ‰¹é‡è®¡ç®—æ€§èƒ½

**æµ‹è¯•æ–¹æ³•**ï¼š
```bash
# æ¨¡æ‹Ÿ 5 ä¸ªçƒ­ç‚¹æ–‡ä»¶çš„å¤æ‚åº¦è®¡ç®—
for i in {1..5}; do
  timeout 1s get_complexity "file$i.py"
done
```

**é€šè¿‡æ ‡å‡†**ï¼šæ€»æ—¶é—´ < 5.0s

---

## æµ‹è¯•éš”ç¦»è¦æ±‚

- [x] æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–æ‰§è¡Œé¡ºåº
- [x] æµ‹è¯•å‰åæ¸…ç†ä¸´æ—¶æ–‡ä»¶
- [x] PATH éš”ç¦»ï¼ˆç”¨äºé™çº§æµ‹è¯•ï¼‰
- [x] ä¸´æ—¶ Git ä»“åº“éš”ç¦»

---

## æµ‹è¯•æ–‡ä»¶ç»“æ„

```
tests/
â””â”€â”€ enhance-code-intelligence/
    â”œâ”€â”€ test_hotspot.bats          # AC-001, AC-002
    â”œâ”€â”€ test_index_detection.bats  # AC-003
    â”œâ”€â”€ test_performance.bats      # AC-004, AC-005
    â””â”€â”€ fixtures/
        â”œâ”€â”€ mock_project/          # æ¨¡æ‹Ÿé¡¹ç›®ç›®å½•
        â””â”€â”€ sample_files/          # æµ‹è¯•ç”¨æ ·æœ¬æ–‡ä»¶
```

---

## Red åŸºçº¿çŠ¶æ€ï¼ˆ2026-01-08 å·²è¿è¡Œï¼‰

| æµ‹è¯•ç”¨ä¾‹ | é¢„æœŸçŠ¶æ€ | å®é™…çŠ¶æ€ | è¯´æ˜ |
|----------|----------|----------|------|
| TC-001 | FAIL | **PASS** | complexity å­—æ®µå­˜åœ¨ï¼ˆä½†å§‹ç»ˆä¸º 1ï¼‰ |
| TC-001b | FAIL | **PASS** | score å­—æ®µå­˜åœ¨ |
| TC-001c | FAIL | **PASS** | score = changes Ã— complexity è®¡ç®—æ­£ç¡® |
| TC-002 | FAIL | **FAIL** | æ— å®‰è£…æç¤º |
| TC-002b | FAIL | **FAIL** | å·¥å…·ç¼ºå¤±æ—¶ä»æ˜¾ç¤º complexity: 1 |
| TC-002c | PASS | **PASS** | Hook æ­£å¸¸é€€å‡º |
| TC-003 | PASS | **PASS** | CKB æç¤ºå­˜åœ¨ |
| TC-003b | FAIL | **FAIL** | æ— è¿è¡Œå‘½ä»¤ `/devbooks-index-bootstrap` |
| TC-004 | PASS | **PASS** | SCIP ç´¢å¼•æ£€æµ‹æ­£ç¡® |
| TC-005 | PASS | **PASS** | CKB ç¼“å­˜æ£€æµ‹æ­£ç¡® |
| TC-005b | PASS | **FAIL** | æ–­è¨€éœ€è°ƒæ•´ï¼ˆä¸­æ–‡è¾“å‡ºï¼‰ |
| TC-006 | PASS | **PASS** | Hook è€—æ—¶ 0.15s < 5s |
| TC-007 | PASS | **PASS** | å¤æ‚åº¦è®¡ç®— 0.03s < 5s |
| TC-007b | PASS | **PASS** | è¶…æ—¶ä¿æŠ¤æœ‰æ•ˆ |
| TC-006b | PASS | **PASS** | çƒ­ç‚¹é™åˆ¶ 5 ä¸ª |

**ç»Ÿè®¡**ï¼š15 ä¸ªæµ‹è¯•ï¼Œ11 é€šè¿‡ï¼Œ4 å¤±è´¥

**Red åŸºçº¿åˆ†æ**ï¼š
1. **AC-001 éƒ¨åˆ†æ»¡è¶³**ï¼šcomplexity/score å­—æ®µå·²å­˜åœ¨ï¼Œä½† complexity å§‹ç»ˆä¸º 1ï¼ˆç¡¬ç¼–ç ï¼‰ï¼Œæœªå®é™…è°ƒç”¨å¤æ‚åº¦å·¥å…·
2. **AC-002 æœªæ»¡è¶³**ï¼šç¼ºå°‘å·¥å…·ç¼ºå¤±æ—¶çš„å®‰è£…æç¤ºï¼Œä¸”é™çº§æ—¶ä»æ˜¾ç¤º complexity å­—æ®µ
3. **AC-003 éƒ¨åˆ†æ»¡è¶³**ï¼šCKB æç¤ºå­˜åœ¨ï¼Œä½†ç¼ºå°‘è¿è¡Œå‘½ä»¤
4. **AC-004 å·²æ»¡è¶³**ï¼šæ€§èƒ½è¾¾æ ‡
5. **AC-005 å·²æ»¡è¶³**ï¼šå¤æ‚åº¦è®¡ç®—æ€§èƒ½è¾¾æ ‡

**è¯æ®è½ç‚¹**ï¼š`evidence/red-baseline/test-20260108.log`

---

## DoD è´¨é‡é—¸é—¨

| é—¸é—¨ | å‘½ä»¤ | é€šè¿‡æ ‡å‡† | çŠ¶æ€ |
|------|------|----------|------|
| è„šæœ¬è¯­æ³•æ£€æŸ¥ | `shellcheck tests/**/*.bats setup/global-hooks/*.sh tools/*.sh` | æ—  Error | å¾…è¿è¡Œ |
| å•å…ƒæµ‹è¯• | `bats tests/enhance-code-intelligence/` | 100% Pass | å¾…è¿è¡Œ |
| æ€§èƒ½åŸºçº¿ | è§ TC-006, TC-007 | < 5s | å¾…è¿è¡Œ |

---

*æ–‡æ¡£ç‰ˆæœ¬*: 1.0
*ç”Ÿæˆæ—¶é—´*: 2026-01-08
*Test Owner*: AI (ç‹¬ç«‹å¯¹è¯)
