# ææ¡ˆï¼šboost-local-intelligence

> æå‡ DevBooks æœ¬åœ°æ™ºèƒ½èƒ½åŠ›ï¼Œæ¶ˆé™¤å¤–éƒ¨ API ä¾èµ–ï¼Œå¢å¼ºä»£ç ç†è§£ä¸å¯è§†åŒ–

---

## 1. Whyï¼ˆé—®é¢˜ä¸ç›®æ ‡ï¼‰

### 1.1 é—®é¢˜é™ˆè¿°

å½“å‰ DevBooks çš„ Augment é£æ ¼åŠŸèƒ½å­˜åœ¨ä»¥ä¸‹ç—›ç‚¹ï¼š

1. **Embedding ä¾èµ–å¤–éƒ¨ API**ï¼šå½“å‰ `tools/devbooks-embedding.sh` ä»…æ”¯æŒ OpenAI APIï¼Œå¯¼è‡´ï¼š
   - éœ€è¦ä»˜è´¹ API Key
   - ä¼ä¸šé˜²ç«å¢™ç¯å¢ƒæ— æ³•ä½¿ç”¨
   - ä»£ç ä¸Šä¼ äº‘ç«¯å­˜åœ¨éšç§é¡¾è™‘
   - ç½‘ç»œå»¶è¿Ÿå½±å“ç”¨æˆ·ä½“éªŒ

2. **å›¾éå†èƒ½åŠ›ä¸å®Œæ•´**ï¼šå½“å‰ `tools/graph-rag-context.sh` çš„å›¾éå†ä»…é€šè¿‡ import è¯­å¥è§£æï¼Œè€ŒéçœŸæ­£è°ƒç”¨ CKB MCP APIï¼Œå¯¼è‡´ï¼š
   - æ— æ³•è·å–å®Œæ•´çš„è°ƒç”¨å…³ç³»
   - æ— æ³•è¿›è¡Œå¤šè·³éå†ï¼ˆcallers/calleesï¼‰
   - ç²¾åº¦ä½äº Augment çš„ UCG å›¾éå†

3. **ç†µåº¦é‡ç¼ºä¹å¯è§†åŒ–**ï¼šå½“å‰ `devbooks-entropy-monitor` ä»…äº§å‡º Markdown æŠ¥å‘Šï¼Œç¼ºä¹ï¼š
   - è¶‹åŠ¿å›¾è¡¨
   - çƒ­ç‚¹åœ°å›¾
   - é˜ˆå€¼é¢„è­¦ä»ªè¡¨ç›˜

### 1.2 ç›®æ ‡

- **G1**ï¼šå®ç°æœ¬åœ°ä¼˜å…ˆçš„ Embedding æ–¹æ¡ˆï¼ˆOllama ä¼˜å…ˆï¼ŒAPI é™çº§ï¼‰
- **G2**ï¼šæ›¿æ¢ import è§£æä¸ºçœŸæ­£çš„ CKB API è°ƒç”¨ï¼ˆsearchSymbols/getCallGraph/findReferencesï¼‰
- **G3**ï¼šä¸ºç†µåº¦é‡å¢åŠ  Mermaid å›¾è¡¨ä¸ ASCII ä»ªè¡¨ç›˜
- **G4**ï¼šè¯†åˆ«å¹¶å®ç°å…¶ä»–é«˜ ROI æ”¹è¿›é¡¹

---

## 2. What Changesï¼ˆèŒƒå›´ï¼‰

### 2.1 æ ¸å¿ƒæ”¹è¿›é¡¹ï¼ˆ4 é¡¹ï¼‰

| æ”¹è¿›é¡¹ | ä¼˜å…ˆçº§ | æ¶‰åŠæ–‡ä»¶ | äº§å‡º |
|-------|-------|---------|------|
| **P1: æœ¬åœ° Embedding** | é«˜ | `tools/devbooks-embedding.sh`, `tools/embedding-helper.py`, `.devbooks/config.yaml` | Ollama é›†æˆ + è‡ªåŠ¨é™çº§ |
| **P2: CKB çœŸå®å›¾éå†** | é«˜ | `tools/graph-rag-context.sh`, `tools/call-chain-tracer.sh` | æ›¿æ¢ import è§£æä¸º CKB API |
| **P3: ç†µåº¦é‡å¯è§†åŒ–** | ä¸­ | `skills/devbooks-entropy-monitor/SKILL.md`, `tools/devbooks-entropy-viz.sh`ï¼ˆæ–°å»ºï¼‰ | Mermaid å›¾ + ASCII ä»ªè¡¨ç›˜ |
| **P4: é…ç½®ç»Ÿä¸€ä¸é»˜è®¤å¯ç”¨** | ä¸­ | `.devbooks/config.yaml`, æ–‡æ¡£ | embedding.provider: ollama ä¸ºé»˜è®¤ |

### 2.2 é™„åŠ é«˜ ROI æ”¹è¿›é¡¹ï¼ˆ1 é¡¹ï¼‰

| æ”¹è¿›é¡¹ | ä¼˜å…ˆçº§ | æ¶‰åŠæ–‡ä»¶ | äº§å‡º |
|-------|-------|---------|------|
| **P5: æ„å›¾åˆ†ç±»å¢å¼º** | ä¸­ | `tools/devbooks-common.sh` | å››åˆ†ç±»ï¼ˆè°ƒè¯•/é‡æ„/æ–°åŠŸèƒ½/æ–‡æ¡£ï¼‰ |

### 2.3 å·²è£å†³æ’é™¤é¡¹

| æ”¹è¿›é¡¹ | æ’é™¤åŸå›  |
|-------|---------|
| ~~P6: åŠ¨æ€ Token é¢„ç®—~~ | ROI ä¸è¶³ï¼Œå¤æ‚åº¦é«˜ï¼Œå¯ä½œä¸ºåç»­è¿­ä»£ |

### 2.4 éç›®æ ‡ï¼ˆæ˜ç¡®æ’é™¤ï¼‰

- âŒ æ•°æ®æµåˆ†æï¼ˆPDGï¼‰ï¼šæŠ•å…¥å·¨å¤§ï¼Œéœ€ç¼–è¯‘å™¨çº§æ”¯æŒ
- âŒ 40ä¸‡+æ–‡ä»¶è§„æ¨¡æ”¯æŒï¼šéœ€é‡å†™æ¶æ„
- âŒ 200ms å»¶è¿Ÿä¼˜åŒ–ï¼šéœ€è‡ªæœ‰æ¨ç†å †æ ˆ
- âŒ æ¶æ„æ¼‚ç§»æ£€æµ‹ï¼šå¤æ‚åº¦é«˜ï¼ŒROI ä¸ç¡®å®š

### 2.4 å½±å“èŒƒå›´

**ç›´æ¥å½±å“çš„æ¨¡å—/æ–‡ä»¶**ï¼ˆå…± 8 ä¸ªï¼‰ï¼š

1. `tools/devbooks-embedding.sh` - å¢åŠ  Ollama provider
2. `tools/embedding-helper.py` - å¢åŠ æœ¬åœ°æ¨¡å‹æ”¯æŒ
3. `tools/graph-rag-context.sh` - æ›¿æ¢ import è§£æä¸º CKB API
4. `tools/call-chain-tracer.sh` - å¢å¼º CKB API è°ƒç”¨
5. `tools/devbooks-common.sh` - å¢åŠ æ„å›¾å››åˆ†ç±»
6. `tools/devbooks-entropy-viz.sh` - æ–°å»ºï¼Œç†µåº¦é‡å¯è§†åŒ–
7. `skills/devbooks-entropy-monitor/SKILL.md` - æ›´æ–°äº§ç‰©æ ¼å¼
8. `.devbooks/config.yaml` - å¢åŠ  embedding.provider é…ç½®

**é—´æ¥å½±å“çš„æ¨¡å—**ï¼ˆå…± 3 ä¸ªï¼‰ï¼š

1. `.claude/hooks/augment-context.sh` - è°ƒç”¨ embedding çš„æ–¹å¼å¯èƒ½å˜åŒ–
2. `setup/global-hooks/augment-context-global.sh` - åŒä¸Š
3. `docs/embedding-quickstart.md` - éœ€æ›´æ–°æ–‡æ¡£

---

## 3. Impactï¼ˆå½±å“åˆ†æï¼‰

> **åˆ†ææ¨¡å¼**ï¼šæ–‡æœ¬æœç´¢ï¼ˆSCIP ç´¢å¼•ä¸å¯ç”¨ï¼‰+ Git çƒ­ç‚¹åˆ†æ
> **åˆ†ææ—¶é—´**ï¼š2026-01-09
> **ç½®ä¿¡åº¦**ï¼š79%ï¼ˆç¼ºå°‘ SCIP ç´¢å¼•çš„è€¦åˆåˆ†æï¼‰

### 3.1 Transaction Scope

**Single-DB**ï¼šæ‰€æœ‰æ”¹åŠ¨ä»…æ¶‰åŠæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå’Œè¿›ç¨‹å†…è°ƒç”¨ï¼Œæ— è·¨æœåŠ¡äº‹åŠ¡ã€‚

### 3.2 å½±å“èŒƒå›´æ±‡æ€»

| æ”¹è¿›é¡¹ | ç›´æ¥å½±å“æ–‡ä»¶ | é—´æ¥å½±å“æ–‡ä»¶ | çƒ­ç‚¹é‡å  | é£é™©ç­‰çº§ |
|-------|------------|------------|---------|---------|
| **P1: æœ¬åœ° Embedding** | 3 | 25 | 1 âš ï¸ | ä¸­ |
| **P2: CKB å›¾éå†** | 2 | 18 | 0 | ä½ |
| **P3: ç†µåº¦é‡å¯è§†åŒ–** | 2 | 8 | 0 | ä½ |
| **P4: é…ç½®ç»Ÿä¸€** | 1 | å…¨å±€ | 0 | ä½ |
| **P5: æ„å›¾åˆ†ç±»** | 1 | 6 | 1 âš ï¸ | ä¸­ |
| **åˆè®¡** | **9** | **57ï¼ˆå»é‡åçº¦ 35ï¼‰** | **2** | **ä¸­** |

### 3.3 è¯¦ç»†å½±å“åˆ†æ

#### P1: æœ¬åœ° Embeddingï¼ˆé«˜é£é™©åŒºåŸŸï¼‰

**ç›´æ¥å½±å“**ï¼ˆ3 ä¸ªæ–‡ä»¶ï¼‰ï¼š
| æ–‡ä»¶ | å½±å“ç±»å‹ | é£é™© | çƒ­ç‚¹? |
|------|---------|------|-------|
| `tools/devbooks-embedding.sh` | æ ¸å¿ƒæ”¹åŠ¨ | é«˜ | - |
| `tools/embedding-helper.py` | æ ¸å¿ƒæ”¹åŠ¨ | ä¸­ | - |
| `.devbooks/config.yaml` | é…ç½®æ‰©å±• | ä½ | - |

**é—´æ¥å½±å“**ï¼ˆ25 ä¸ªæ–‡ä»¶å¼•ç”¨ `devbooks-embedding`ï¼‰ï¼š
| ç±»åˆ« | æ–‡ä»¶æ•° | å…³é”®æ–‡ä»¶ |
|------|-------|---------|
| Hooks | 2 | `.claude/hooks/augment-context.sh` âš ï¸çƒ­ç‚¹#4, `setup/global-hooks/augment-context-global.sh` |
| Tools | 2 | `tools/graph-rag-context.sh`, `tools/test-embedding.sh` |
| Docs | 4 | `docs/embedding-quickstart.md`, `docs/embedding-guide.md`, `docs/Augment-vs-DevBooks-æŠ€æœ¯å¯¹æ¯”.md`, `ä½¿ç”¨è¯´æ˜ä¹¦.md` |
| Specs | 3 | `openspec/specs/embedding/spec.md`, `openspec/specs/architecture/c4.md`, `openspec/specs/_meta/project-profile.md` |
| Tests | 3 | `tests/achieve-augment-parity/test_embedding.bats` ç­‰ |
| Archive | 11 | å·²å½’æ¡£å˜æ›´åŒ…ï¼ˆåªè¯»ï¼Œä¸éœ€æ”¹åŠ¨ï¼‰ |

**çƒ­ç‚¹è­¦å‘Š**ï¼š
- âš ï¸ `.claude/hooks/augment-context.sh` - çƒ­ç‚¹æ’å #4ï¼ˆ3 æ¬¡å˜æ›´ï¼Œå¹³å‡ 171 è¡Œ/æ¬¡ï¼‰
- å»ºè®®ï¼šè¯¥æ–‡ä»¶æ”¹åŠ¨éœ€å¢åŠ æµ‹è¯•è¦†ç›–

#### P2: CKB å›¾éå†

**ç›´æ¥å½±å“**ï¼ˆ2 ä¸ªæ–‡ä»¶ï¼‰ï¼š
| æ–‡ä»¶ | å½±å“ç±»å‹ | é£é™© | çƒ­ç‚¹? |
|------|---------|------|-------|
| `tools/graph-rag-context.sh` | æ ¸å¿ƒæ”¹åŠ¨ | ä¸­ | - |
| `tools/call-chain-tracer.sh` | æ ¸å¿ƒæ”¹åŠ¨ | ä¸­ | - |

**é—´æ¥å½±å“**ï¼ˆ18 ä¸ªæ–‡ä»¶å¼•ç”¨ï¼‰ï¼š
| ç±»åˆ« | æ–‡ä»¶æ•° | å…³é”®æ–‡ä»¶ |
|------|-------|---------|
| Hooks | 1 | `setup/global-hooks/augment-context-global.sh` |
| Tools | 1 | `tools/bug-locator.sh`ï¼ˆè°ƒç”¨ call-chain-tracerï¼‰ |
| Tests | 5 | `tests/achieve-augment-parity/test_graph_rag.bats` ç­‰ |
| Docs/Specs | 6 | C4 æ¶æ„å›¾ã€å¯¹æ¯”æ–‡æ¡£ç­‰ |
| Archive | 5 | å·²å½’æ¡£å˜æ›´åŒ… |

#### P3: ç†µåº¦é‡å¯è§†åŒ–

**ç›´æ¥å½±å“**ï¼ˆ2 ä¸ªæ–‡ä»¶ï¼‰ï¼š
| æ–‡ä»¶ | å½±å“ç±»å‹ | é£é™© | çƒ­ç‚¹? |
|------|---------|------|-------|
| `skills/devbooks-entropy-monitor/SKILL.md` | æ›´æ–°äº§ç‰©æ ¼å¼ | ä½ | - |
| `tools/devbooks-entropy-viz.sh` | **æ–°å»º** | ä½ | - |

**é—´æ¥å½±å“**ï¼ˆ8 ä¸ªæ–‡ä»¶å¼•ç”¨ `entropy-monitor`ï¼‰ï¼š
- `openspec/project.md`ï¼ˆè§’è‰²å®šä¹‰ï¼‰
- `Skillsä½¿ç”¨è¯´æ˜.md`ã€`è§’è‰²ä½¿ç”¨è¯´æ˜.md`ï¼ˆæ–‡æ¡£ï¼‰
- æ¨¡æ¿æ–‡ä»¶ï¼ˆ4 ä¸ªï¼‰

#### P5: æ„å›¾åˆ†ç±»

**ç›´æ¥å½±å“**ï¼ˆ1 ä¸ªæ–‡ä»¶ï¼‰ï¼š
| æ–‡ä»¶ | å½±å“ç±»å‹ | é£é™© | çƒ­ç‚¹? |
|------|---------|------|-------|
| `tools/devbooks-common.sh` | å¢å¼ºå‡½æ•° | ä¸­ | - |

**é—´æ¥å½±å“**ï¼ˆ6 ä¸ªæ–‡ä»¶è°ƒç”¨ `devbooks-common`ï¼‰ï¼š
| æ–‡ä»¶ | å½±å“ç±»å‹ | çƒ­ç‚¹? |
|------|---------|-------|
| `.claude/hooks/augment-context.sh` | è°ƒç”¨æ–¹ | âš ï¸çƒ­ç‚¹#4 |
| `setup/global-hooks/augment-context-global.sh` | è°ƒç”¨æ–¹ | - |
| `tools/graph-rag-context.sh` | è°ƒç”¨æ–¹ | - |
| `tools/bug-locator.sh` | è°ƒç”¨æ–¹ | - |
| `tools/call-chain-tracer.sh` | è°ƒç”¨æ–¹ | - |

### 3.4 å¯¹å¤–å¥‘çº¦å½±å“

| å¥‘çº¦ | å˜æ›´ç±»å‹ | å…¼å®¹æ€§ | æ¶ˆè´¹è€… |
|-----|---------|-------|-------|
| `devbooks-embedding.sh` CLI | æ–°å¢ `--provider` å‚æ•° | âœ… å‘åå…¼å®¹ | hooks, ç”¨æˆ·è„šæœ¬ |
| `.devbooks/config.yaml` | æ–°å¢ `embedding.provider` å­—æ®µ | âœ… å‘åå…¼å®¹ | æ‰€æœ‰ tools |
| `graph-rag-context.sh` JSON | æ–°å¢ `source: "ckb"` å­—æ®µ | âœ… å‘åå…¼å®¹ | hooks |
| `devbooks-common.sh` å‡½æ•° | `is_code_intent()` è¿”å›å€¼æ‰©å±• | âš ï¸ éœ€éªŒè¯è°ƒç”¨æ–¹ | 6 ä¸ªæ–‡ä»¶ |
| ç†µæŠ¥å‘Š Markdown | æ–°å¢ Mermaid ä»£ç å— | âœ… å‘åå…¼å®¹ | äººç±»é˜…è¯» |

### 3.5 æ¨¡å—ä¾èµ–å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           è°ƒç”¨å±‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  .claude/hooks/augment-context.sh âš ï¸çƒ­ç‚¹                             â”‚
â”‚  setup/global-hooks/augment-context-global.sh                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ P1: Embedding â”‚   â”‚ P2: Graph-RAG â”‚   â”‚ P5: Common    â”‚
â”‚ (devbooks-    â”‚   â”‚ (graph-rag-   â”‚   â”‚ (devbooks-    â”‚
â”‚  embedding.sh)â”‚   â”‚  context.sh)  â”‚   â”‚  common.sh)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚
        â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ embedding-    â”‚   â”‚ call-chain-   â”‚
â”‚ helper.py     â”‚   â”‚ tracer.sh     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ CKB MCP API   â”‚
                    â”‚ (å¤–éƒ¨ä¾èµ–)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Skills å±‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  skills/devbooks-entropy-monitor/SKILL.md                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ P3: entropy-  â”‚
                    â”‚ viz.sh (æ–°å»º) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.6 æµ‹è¯•å½±å“

| æµ‹è¯•ç±»åˆ« | ç°æœ‰æµ‹è¯• | éœ€æ–°å¢ | éœ€ä¿®æ”¹ |
|---------|---------|-------|-------|
| Embedding | `test_embedding.bats` | Ollama provider æµ‹è¯• | æ‰©å±•é™çº§æµ‹è¯• |
| Graph-RAG | `test_graph_rag.bats` | CKB API mock æµ‹è¯• | æ‰©å±• source å­—æ®µéªŒè¯ |
| Call-chain | `test_call_chain.bats` | - | æ‰©å±•æ·±åº¦æµ‹è¯• |
| ç†µå¯è§†åŒ– | æ—  | Mermaid è¾“å‡ºéªŒè¯ | - |
| æ„å›¾åˆ†ç±» | æ—  | å››åˆ†ç±»å•å…ƒæµ‹è¯• | - |

### 3.7 ä»·å€¼ä¿¡å·

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | åº¦é‡æ–¹å¼ |
|-----|-------|-------|---------|
| Embedding ç¦»çº¿å¯ç”¨ | 0% | 100% | Ollama æ— ç½‘ç»œæ—¶ä»å¯ç”¨ |
| å›¾éå†ç²¾åº¦ | 60%ï¼ˆimport è§£æï¼‰ | 85%ï¼ˆCKB APIï¼‰ | 10 ä¸ªé¢„è®¾æŸ¥è¯¢å‘½ä¸­ç‡ |
| ç†µæŠ¥å‘Šå¯è¯»æ€§ | çº¯æ–‡æœ¬ | å›¾è¡¨+ä»ªè¡¨ç›˜ | ç”¨æˆ·åé¦ˆ |
| Hook å“åº”å»¶è¿Ÿ | <3s | <3s | ä¿æŒä¸å˜ï¼ˆæœ¬åœ°æ›´å¿«ï¼‰ |
| æ„å›¾åˆ†ç±»å‡†ç¡®ç‡ | 50%ï¼ˆäºŒåˆ†ç±»ï¼‰ | 80%ï¼ˆå››åˆ†ç±»ï¼‰ | 20 ä¸ªé¢„è®¾æŸ¥è¯¢ |

### 3.8 é£é™©çƒ­ç‚¹æ€»ç»“

| æ–‡ä»¶ | çƒ­ç‚¹æ’å | å˜æ›´æ¬¡æ•° | æœ¬æ¬¡æ¶‰åŠ | å»ºè®® |
|-----|---------|---------|---------|------|
| `.claude/hooks/augment-context.sh` | #4 | 3 | P1, P5 | å¢åŠ æµ‹è¯•è¦†ç›–ï¼Œè°¨æ…æ”¹åŠ¨ |
| `mcp/devbooks-mcp-server/src/index.ts` | #1 | 2 | æ—  | æœ¬æ¬¡ä¸æ¶‰åŠ |
| `ä½¿ç”¨è¯´æ˜ä¹¦.md` | #3 | 5 | æ–‡æ¡£æ›´æ–° | ä½é£é™© |

### 3.9 Minimal Diff å»ºè®®

1. **P1 æœ€å°æ”¹åŠ¨**ï¼šåªåœ¨ `devbooks-embedding.sh` ä¸­å¢åŠ  Ollama åˆ†æ”¯ï¼Œä¸é‡æ„ç°æœ‰é€»è¾‘
2. **P2 æœ€å°æ”¹åŠ¨**ï¼šåœ¨ `graph-rag-context.sh` ä¸­å¢åŠ  CKB API è°ƒç”¨ä½œä¸ºä¼˜å…ˆè·¯å¾„ï¼Œä¿ç•™ import è§£æä½œä¸ºé™çº§
3. **P5 æœ€å°æ”¹åŠ¨**ï¼šæ‰©å±• `is_code_intent()` è¿”å›å€¼ï¼Œä¸æ”¹å˜å‡½æ•°ç­¾å

### 3.10 Open Questionsï¼ˆå½±å“åˆ†æç›¸å…³ï¼‰

1. **Q1**ï¼š`is_code_intent()` è¿”å›å€¼ä» boolean å˜ä¸º stringï¼Œæ˜¯å¦éœ€è¦æ›´æ–°æ‰€æœ‰ 6 ä¸ªè°ƒç”¨æ–¹ï¼Ÿ
   - å»ºè®®ï¼šä¿æŒå‡½æ•°ç­¾åå…¼å®¹ï¼Œæ–°å¢ `get_intent_type()` å‡½æ•°
2. **Q2**ï¼šçƒ­ç‚¹æ–‡ä»¶ `.claude/hooks/augment-context.sh` æœ¬æ¬¡æ¶‰åŠä¸¤é¡¹æ”¹åŠ¨ï¼Œæ˜¯å¦éœ€è¦æ‹†åˆ†ï¼Ÿ
   - å»ºè®®ï¼šP1 å’Œ P5 å¯ä»¥åˆå¹¶å®ç°ï¼Œä½†éœ€è¦å……åˆ†æµ‹è¯•

---

## 4. Risks & Rollbackï¼ˆé£é™©ä¸å›æ»šï¼‰

### 4.1 é£é™©æ¸…å•

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|-----|-----|---------|
| **R1: Ollama æœªå®‰è£…å¯¼è‡´ Embedding ä¸å¯ç”¨** | é«˜ | ä¸­ | å®ç°ä¸‰çº§é™çº§ï¼šOllama â†’ OpenAI API â†’ å…³é”®è¯æœç´¢ |
| **R2: CKB MCP ä¸å¯ç”¨å¯¼è‡´å›¾éå†å¤±è´¥** | ä¸­ | ä¸­ | ä¿ç•™ import è§£æä½œä¸ºé™çº§æ–¹æ¡ˆ |
| **R3: æœ¬åœ°æ¨¡å‹è´¨é‡ä¸å¦‚ API** | ä½ | ä½ | æ–‡æ¡£è¯´æ˜è´¨é‡å·®å¼‚ï¼ˆ4-8%ï¼‰ï¼Œç”¨æˆ·å¯é€‰åˆ‡æ¢ |
| **R4: ç†µå¯è§†åŒ–åœ¨æŸäº›ç»ˆç«¯æ¸²æŸ“å¼‚å¸¸** | ä¸­ | ä½ | æä¾›çº¯æ–‡æœ¬ fallback |

### 4.2 å›æ»šç­–ç•¥

- **é…ç½®å›æ»š**ï¼šå°† `embedding.provider` æ”¹å› `openai` å³å¯æ¢å¤åŸè¡Œä¸º
- **ä»£ç å›æ»š**ï¼šæ‰€æœ‰æ”¹åŠ¨åœ¨ç‹¬ç«‹æ–‡ä»¶/å‡½æ•°ä¸­ï¼Œå¯é€šè¿‡ git revert å›æ»š
- **é™çº§æœºåˆ¶**ï¼šå³ä½¿æ–°åŠŸèƒ½å¤±è´¥ï¼Œè‡ªåŠ¨é™çº§åˆ°åŸæœ‰è¡Œä¸ºï¼Œä¸å½±å“åŸºæœ¬åŠŸèƒ½

---

## 5. Validationï¼ˆéªŒæ”¶é”šç‚¹ï¼‰

### 5.1 éªŒæ”¶æ ‡å‡†ï¼ˆACï¼‰

| AC-ID | æè¿° | éªŒè¯æ–¹å¼ |
|-------|------|---------|
| **AC-001** | Ollama å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨æœ¬åœ°æ¨¡å‹ | `./tools/devbooks-embedding.sh search "auth" --provider ollama` è¿”å›ç»“æœ |
| **AC-002** | Ollama ä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§åˆ° API | åœæ­¢ Ollama åï¼Œ`--provider auto` ä½¿ç”¨ OpenAI API |
| **AC-003** | API ä¸å¯ç”¨æ—¶é™çº§åˆ°å…³é”®è¯æœç´¢ | æ—  API Key æ—¶ï¼Œè¾“å‡º `degraded_to: keyword` |
| **AC-004** | CKB API æ›¿ä»£ import è§£æ | `graph-rag-context.sh` è¾“å‡ºåŒ…å« `source: "ckb"` |
| **AC-005** | å›¾éå†æ”¯æŒ 2-4 è·³ | `call-chain-tracer.sh --depth 3` è¿”å›å¤šè·³ç»“æœ |
| **AC-006** | ç†µæŠ¥å‘ŠåŒ…å« Mermaid å›¾ | `entropy-report-*.md` åŒ…å« `\`\`\`mermaid` ä»£ç å— |
| **AC-007** | æ„å›¾å››åˆ†ç±»ç”Ÿæ•ˆ | `is_code_intent` è¿”å› debug/refactor/feature/docs ä¹‹ä¸€ |
| **AC-008** | å‘åå…¼å®¹ | ä¸å¸¦æ–°å‚æ•°æ—¶ï¼Œè¡Œä¸ºä¸åŸç‰ˆä¸€è‡´ |

### 5.2 è¯æ®è½ç‚¹

- æµ‹è¯•æ—¥å¿—ï¼š`openspec/changes/boost-local-intelligence/evidence/`
- éªŒæ”¶æŠ¥å‘Šï¼š`openspec/changes/boost-local-intelligence/verification.md`

---

## 6. Debate Packetï¼ˆäº‰è®®ç‚¹ï¼‰

### 6.1 éœ€è¾©è®ºçš„é—®é¢˜

| ç¼–å· | é—®é¢˜ | æ­£æ–¹è§‚ç‚¹ | åæ–¹è§‚ç‚¹ | å»ºè®®è£å†³æ–¹ |
|-----|------|---------|---------|-----------|
| **D1** | Ollama æ˜¯å¦åº”ä½œä¸ºé»˜è®¤ providerï¼Ÿ | é›¶æˆæœ¬ã€ç¦»çº¿å¯ç”¨ã€éšç§åˆè§„ | éœ€è¦ç”¨æˆ·å®‰è£… Ollamaï¼Œå¢åŠ é—¨æ§› | Judge |
| **D2** | CKB API ä¸å¯ç”¨æ—¶æ˜¯å¦ä¿ç•™ import è§£æï¼Ÿ | ä¿è¯åŸºæœ¬å¯ç”¨æ€§ | å¢åŠ ä»£ç å¤æ‚åº¦ï¼Œç»´æŠ¤æˆæœ¬é«˜ | Judge |
| **D3** | ç†µå¯è§†åŒ–æ˜¯å¦éœ€è¦ Web ä»ªè¡¨ç›˜ï¼Ÿ | æ›´å¥½çš„äº¤äº’ä½“éªŒ | è¶…å‡ºå½“å‰èŒƒå›´ï¼Œå¯ä½œä¸ºåç»­è¿­ä»£ | Judge |
| **D4** | æ˜¯å¦å°† P5/P6 çº³å…¥æœ¬æ¬¡å˜æ›´ï¼Ÿ | ROI é«˜ï¼Œé¡ºä¾¿å®ç° | èŒƒå›´è”“å»¶é£é™©ï¼Œå»ºè®®å•ç‹¬å˜æ›´åŒ… | Judge |

### 6.2 ä¸ç¡®å®šç‚¹

1. **Ollama æ¨¡å‹é€‰æ‹©**ï¼š`nomic-embed-text` vs `mxbai-embed-large`ï¼Œéœ€è¦å®æµ‹å¯¹æ¯”
2. **CKB API å¯ç”¨æ€§æ£€æµ‹**ï¼šå¦‚ä½•å¿«é€Ÿåˆ¤æ–­ CKB MCP æ˜¯å¦åœ¨çº¿ï¼Ÿ
3. **Mermaid æ¸²æŸ“å…¼å®¹æ€§**ï¼šä¸åŒ Markdown æ¸²æŸ“å™¨å¯¹ Mermaid æ”¯æŒä¸ä¸€

### 6.3 å·²çŸ¥é£é™©

- æœ¬åœ°æ¨¡å‹è´¨é‡æ¯” API ä½ 4-8%ï¼ˆå·²åœ¨ Risks ä¸­è®°å½•ï¼‰
- Ollama é¦–æ¬¡ä¸‹è½½æ¨¡å‹éœ€è¦ 300MB-2GBï¼ˆéœ€æ–‡æ¡£è¯´æ˜ï¼‰

---

## 7. Decision Logï¼ˆå†³ç­–æ—¥å¿—ï¼‰

### 7.1 å†³ç­–çŠ¶æ€

**Approved with Conditions**ï¼ˆæœ‰æ¡ä»¶æ‰¹å‡†ï¼‰

### 7.2 éœ€è¦è£å†³çš„é—®é¢˜æ¸…å•

1. [x] D1: Ollama æ˜¯å¦ä½œä¸ºé»˜è®¤ provider â†’ **æ˜¯ï¼Œä½†é€šè¿‡ auto æ¨¡å¼å®ç°ï¼ˆOllama ä¼˜å…ˆï¼‰**
2. [x] D2: import è§£ææ˜¯å¦ä¿ç•™ä½œä¸ºé™çº§ â†’ **æ˜¯ï¼Œä¿ç•™ä½œä¸ºé™çº§**
3. [x] D3: ç†µå¯è§†åŒ–èŒƒå›´ï¼ˆCLI vs Webï¼‰ â†’ **CLI èŒƒå›´**
4. [x] D4: P5/P6 æ˜¯å¦çº³å…¥æœ¬æ¬¡å˜æ›´ â†’ **P5 çº³å…¥ï¼ˆéœ€å¢åŠ æµ‹è¯•ï¼‰ï¼ŒP6 æ’é™¤**

### 7.3 è£å†³è®°å½•

| æ—¥æœŸ | è£å†³è€… | é—®é¢˜ | å†³ç­– | ç†ç”± |
|-----|-------|------|-----|------|
| 2026-01-09 | ç”¨æˆ· | D1: Ollama é»˜è®¤ | Approved | é›¶æˆæœ¬ã€ç¦»çº¿å¯ç”¨ã€éšç§åˆè§„ |
| 2026-01-09 | ç”¨æˆ· | D2: import è§£æé™çº§ | Approved | ä¿è¯åŸºæœ¬å¯ç”¨æ€§ |
| 2026-01-09 | ç”¨æˆ· | D3: ç†µå¯è§†åŒ–èŒƒå›´ | CLI | èšç„¦å½“å‰èŒƒå›´ï¼ŒWeb åç»­è¿­ä»£ |
| 2026-01-09 | ç”¨æˆ· | D4: P5/P6 çº³å…¥ | P5 çº³å…¥ï¼ŒP6 æ’é™¤ | P6 ROI ä¸è¶³ |
| 2026-01-09 | Judge | æœ€ç»ˆè£å†³ | Approved with Conditions | è§ä¸‹æ–¹æ‰¹å‡†æ¡ä»¶ |

### 7.4 Challenger è´¨ç–‘æ‘˜è¦

| ç¼–å· | è´¨ç–‘ç‚¹ | é£é™©ç­‰çº§ | è£å†³é‡‡çº³ |
|------|--------|----------|----------|
| C1 | Ollama å®‰è£…é—¨æ§› | ğŸŸ¡ ä¸­ | âœ… éƒ¨åˆ†é‡‡çº³ï¼šauto æ¨¡å¼ |
| C2 | çƒ­ç‚¹æ–‡ä»¶é›†ä¸­æ”¹åŠ¨ | ğŸ”´ é«˜ | âœ… éƒ¨åˆ†é‡‡çº³ï¼šå¢åŠ æµ‹è¯•è¦æ±‚ |
| C3 | CKB API å¯ç”¨æ€§å‡è®¾ | ğŸŸ¡ ä¸­ | âœ… å·²åœ¨ææ¡ˆä¸­ç¼“è§£ |
| C4 | æœ¬åœ°æ¨¡å‹è´¨é‡å·®å¼‚ | ğŸŸ¢ ä½ | âšª é£é™©å¯æ¥å— |
| C5 | æµ‹è¯•è¦†ç›–ç¼ºå£ | ğŸŸ¡ ä¸­ | âœ… é‡‡çº³ï¼šæµ‹è¯•å‰ç½® |

### 7.5 æ‰¹å‡†æ¡ä»¶

**å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ–¹å¯è¿›å…¥ Apply é˜¶æ®µ**ï¼š

1. **é»˜è®¤ provider è°ƒæ•´**ï¼š
   - å°† `embedding.provider` é»˜è®¤å€¼è®¾ä¸º `auto`
   - `auto` æ¨¡å¼æ£€æµ‹é¡ºåºï¼šOllama â†’ OpenAI API â†’ å…³é”®è¯æœç´¢

2. **æµ‹è¯•å‰ç½®è¦æ±‚**ï¼š
   - æ‰€æœ‰æ”¹è¿›é¡¹å¿…é¡»å…ˆç¼–å†™æµ‹è¯•ï¼ˆRed åŸºçº¿ï¼‰
   - ä¸º `augment-context.sh` å¢åŠ  BATS æµ‹è¯•è¦†ç›–
   - ç†µå¯è§†åŒ–æµ‹è¯•ç”¨ä¾‹ â‰¥ 3
   - æ„å›¾åˆ†ç±»æµ‹è¯•ç”¨ä¾‹ â‰¥ 4

3. **æ–‡æ¡£æ›´æ–°è¦æ±‚**ï¼š
   - æ›´æ–° `docs/embedding-quickstart.md` è¯´æ˜ Ollama å®‰è£…
   - æ›´æ–° `ä½¿ç”¨è¯´æ˜ä¹¦.md` è¯´æ˜æœ¬åœ° vs API è´¨é‡å·®å¼‚ï¼ˆ4-8%ï¼‰

---

## 8. ä¸‹ä¸€æ­¥

1. **Challenger è´¨ç–‘**ï¼šä½¿ç”¨ `devbooks-proposal-challenger` å¯¹æœ¬ææ¡ˆè¿›è¡Œè´¨ç–‘
2. **Judge è£å†³**ï¼šä½¿ç”¨ `devbooks-proposal-judge` å¯¹äº‰è®®ç‚¹è¿›è¡Œè£å†³
3. **Design**ï¼šè£å†³é€šè¿‡åï¼Œä½¿ç”¨ `devbooks-design-doc` äº§å‡º `design.md`
4. **Spec**ï¼šå¦‚æœ‰å¯¹å¤–å¥‘çº¦å˜æ›´ï¼Œä½¿ç”¨ `devbooks-spec-contract` äº§å‡ºè§„æ ¼å¢é‡
5. **Plan**ï¼šä½¿ç”¨ `devbooks-implementation-plan` äº§å‡º `tasks.md`

---

*åˆ›å»ºæ—¶é—´ï¼š2026-01-09*
*ä½œè€…è§’è‰²ï¼šProposal Author*
*å˜æ›´åŒ…ï¼šboost-local-intelligence*
