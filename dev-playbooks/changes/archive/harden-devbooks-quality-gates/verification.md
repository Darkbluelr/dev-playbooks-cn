# Verification: harden-devbooks-quality-gates

---
version: 1.4
status: In-Progress (52/62 passing, 9 Red baseline, 1 skip)
created: 2026-01-11
owner: Test Owner
last_verified: 2026-01-11
phase: Implementation (post-Red baseline)
---

## A) æµ‹è¯•è®¡åˆ’æŒ‡ä»¤è¡¨

### æµ‹è¯•ç­–ç•¥æ¦‚è¿°

æœ¬å˜æ›´æ¶‰åŠ DevBooks è´¨é‡é—¸é—¨å¼ºåŒ–ï¼Œéœ€è¦éªŒè¯ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **Green è¯æ®å¼ºåˆ¶æ£€æŸ¥**ï¼ˆAC-001ï¼‰ï¼šç¡®ä¿ archive æ¨¡å¼å¼ºåˆ¶è¦æ±‚ Green è¯æ®å­˜åœ¨
2. **ä»»åŠ¡å®Œæˆç‡æ£€æŸ¥**ï¼ˆAC-002ï¼‰ï¼šç¡®ä¿ strict æ¨¡å¼éªŒè¯æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ
3. **Coder è§’è‰²è¾¹ç•Œæ£€æŸ¥**ï¼ˆAC-003ï¼‰ï¼šç¡®ä¿ Coder è§’è‰²ä¸èƒ½ä¿®æ”¹ tests/
4. **è§’è‰²äº¤æ¥æ¡æ‰‹æ£€æŸ¥**ï¼ˆAC-004ï¼‰ï¼šç¡®ä¿è§’è‰²äº¤æ¥æœ‰åŒæ–¹ç­¾åç¡®è®¤
5. **P0 ä»»åŠ¡è·³è¿‡æ£€æŸ¥**ï¼ˆAC-005ï¼‰ï¼šç¡®ä¿ P0 ä»»åŠ¡è·³è¿‡éœ€è¦å®¡æ‰¹è®°å½•
6. **æµ‹è¯•ç¯å¢ƒåŒ¹é…æ£€æŸ¥**ï¼ˆAC-006ï¼‰ï¼šç¡®ä¿ verification.md åŒ…å«ç¯å¢ƒå£°æ˜
7. **æµ‹è¯•å¤±è´¥å½’æ¡£æ‹¦æˆª**ï¼ˆAC-007ï¼‰ï¼šç¡®ä¿ Green è¯æ®ä¸­æ— å¤±è´¥è®°å½•
8. **æ–°è„šæœ¬é™æ€æ£€æŸ¥**ï¼ˆAC-008ï¼‰ï¼šç¡®ä¿æ‰€æœ‰è„šæœ¬é€šè¿‡ shellcheck
9. **å¸®åŠ©æ–‡æ¡£å®Œæ•´æ€§**ï¼ˆAC-009ï¼‰ï¼šç¡®ä¿æ‰€æœ‰è„šæœ¬æ”¯æŒ --help
10. **ä»ªè¡¨æ¿è¾“å‡ºéªŒè¯**ï¼ˆAC-010ï¼‰ï¼šç¡®ä¿ä»ªè¡¨æ¿è¾“å‡ºåŒ…å«ä¸‰ä¸ªå¿…è¦èŠ‚
11. **å®¡è®¡å…¨é‡æ‰«æç²¾åº¦**ï¼ˆAC-011ï¼‰ï¼šç¡®ä¿æ‰«æç²¾åº¦åå·® < 1.5x
12. **æµ‹è¯•æ¡†æ¶å¯è¿è¡Œ**ï¼ˆAC-012ï¼‰ï¼šç¡®ä¿ make test å¯æ‰§è¡Œ

### æµ‹è¯•åˆ†å±‚ç­–ç•¥

| ç±»å‹ | æ•°é‡ | è¦†ç›–åœºæ™¯ | é¢„æœŸæ‰§è¡Œæ—¶é—´ |
|------|------|----------|--------------|
| å•å…ƒæµ‹è¯•ï¼ˆBATSï¼‰ | 62 | AC-001 è‡³ AC-012 | < 30s |
| é™æ€æ£€æŸ¥ï¼ˆshellcheckï¼‰ | 8 | AC-008 | < 5s |
| é›†æˆæµ‹è¯• | 0 | åç»­è¿­ä»£ | - |

### æµ‹è¯•æ–‡ä»¶æ¸…å•

| æµ‹è¯•æ–‡ä»¶ | è¦†ç›– AC | æµ‹è¯•æ•°é‡ |
|----------|---------|----------|
| `tests/harden-devbooks-quality-gates/change-check.bats` | AC-001, AC-002, AC-003, AC-005, AC-007 | 15 |
| `tests/harden-devbooks-quality-gates/handoff-check.bats` | AC-004 | 8 |
| `tests/harden-devbooks-quality-gates/env-match-check.bats` | AC-006 | 7 |
| `tests/harden-devbooks-quality-gates/progress-dashboard.bats` | AC-010 | 6 |
| `tests/harden-devbooks-quality-gates/audit-scope.bats` | AC-011 | 8 |
| `tests/harden-devbooks-quality-gates/infrastructure.bats` | AC-008, AC-009, AC-012 | 18 |

---

## B) è¿½æº¯çŸ©é˜µ

| AC ID | éªŒæ”¶æ¡ä»¶ | æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç”¨ä¾‹ | çŠ¶æ€ | è¯æ® |
|-------|----------|----------|----------|------|------|
| AC-001 | Green è¯æ®å¼ºåˆ¶æ£€æŸ¥ | change-check.bats | `AC-001: archive æ¨¡å¼åœ¨æ—  Green è¯æ®æ—¶åº”å¤±è´¥` | ğŸ”´ FAIL | check_evidence_closure() æœªå®ç° |
| AC-001 | Green è¯æ®å¼ºåˆ¶æ£€æŸ¥ | change-check.bats | `AC-001: ç©º green-final ç›®å½•åº”å¤±è´¥` | ğŸ”´ FAIL | è¾¹ç•Œæµ‹è¯•ï¼ŒåŠŸèƒ½æœªå®ç° |
| AC-002 | ä»»åŠ¡å®Œæˆç‡æ£€æŸ¥ | change-check.bats | `AC-002: strict æ¨¡å¼åœ¨ä»»åŠ¡æœªå®Œæˆæ—¶åº”å¤±è´¥` | ğŸ”´ FAIL | check_task_completion_rate() éœ€å¢å¼º |
| AC-003 | Coder è§’è‰²è¾¹ç•Œæ£€æŸ¥ | change-check.bats | `AC-003: coder è§’è‰²ä¿®æ”¹ tests/ æ—¶åº”å¤±è´¥` | ğŸŸ¡ SKIP | éœ€ git ç¯å¢ƒ |
| AC-004 | è§’è‰²äº¤æ¥æ¡æ‰‹æ£€æŸ¥ | handoff-check.bats | `AC-004: æ—  handoff.md æ—¶åº”å¤±è´¥` | âœ… PASS | handoff-check.sh å®Œå…¨å®ç° |
| AC-004 | è§’è‰²äº¤æ¥æ¡æ‰‹æ£€æŸ¥ | handoff-check.bats | `AC-004: å¤šè§’è‰²äº¤æ¥é“¾éªŒè¯` | âœ… PASS | è¾¹ç•Œæµ‹è¯•é€šè¿‡ |
| AC-004 | è§’è‰²äº¤æ¥æ¡æ‰‹æ£€æŸ¥ | handoff-check.bats | `AC-004: å¤šè§’è‰²é“¾ä¸­é—´ç¯èŠ‚æœªç­¾ååº”å¤±è´¥` | âœ… PASS | è¾¹ç•Œæµ‹è¯•é€šè¿‡ |
| AC-005 | P0 ä»»åŠ¡è·³è¿‡æ£€æŸ¥ | change-check.bats | `AC-005: strict æ¨¡å¼ä¸‹ P0 ä»»åŠ¡è·³è¿‡æ— å®¡æ‰¹åº”å¤±è´¥` | ğŸ”´ FAIL | check_skip_approval() æœªå®ç° |
| AC-005 | P0 ä»»åŠ¡è·³è¿‡æ£€æŸ¥ | change-check.bats | `AC-005: æ—  P0 ä»»åŠ¡æ—¶åº”æ­£ç¡®è·³è¿‡æ£€æŸ¥` | ğŸ”´ FAIL | è¾¹ç•Œæµ‹è¯•ï¼ŒåŠŸèƒ½æœªå®ç° |
| AC-006 | æµ‹è¯•ç¯å¢ƒåŒ¹é…æ£€æŸ¥ | env-match-check.bats | `AC-006: verification.md æ— ç¯å¢ƒå£°æ˜æ—¶åº”å¤±è´¥` | âœ… PASS | env-match-check.sh å®Œå…¨å®ç° |
| AC-007 | æµ‹è¯•å¤±è´¥å½’æ¡£æ‹¦æˆª | change-check.bats | `AC-007: archive æ¨¡å¼åœ¨ Green è¯æ®åŒ…å«å¤±è´¥æ—¶åº”å¤±è´¥` | ğŸ”´ FAIL | Green è¯æ®å¤±è´¥æ£€æµ‹æœªå®ç° |
| AC-008 | æ–°è„šæœ¬é™æ€æ£€æŸ¥ | infrastructure.bats | `AC-008: * é€šè¿‡ shellcheck` | âœ… PASS | æ‰€æœ‰ 6 è„šæœ¬é€šè¿‡ shellcheck |
| AC-009 | å¸®åŠ©æ–‡æ¡£å®Œæ•´æ€§ | infrastructure.bats | `AC-009: * æ”¯æŒ --help` | âœ… PASS | æ‰€æœ‰ 5 è„šæœ¬æ”¯æŒ --help |
| AC-010 | ä»ªè¡¨æ¿è¾“å‡ºéªŒè¯ | progress-dashboard.bats | `AC-010: è¾“å‡ºåŒ…å«ä»»åŠ¡å®Œæˆç‡èŠ‚` | âœ… PASS | progress-dashboard.sh å®Œå…¨å®ç° |
| AC-011 | å®¡è®¡å…¨é‡æ‰«æç²¾åº¦ | audit-scope.bats | `AC-011: å¯æ‰«æç›®å½•å¹¶è¾“å‡ºç»“æœ` | âœ… PASS | audit-scope.sh å®Œå…¨å®ç° |
| AC-011 | å®¡è®¡å…¨é‡æ‰«æç²¾åº¦ | audit-scope.bats | `AC-011: æ— æ•ˆ format å‚æ•°åº”è¿”å›é”™è¯¯` | âœ… PASS | è¾¹ç•Œæµ‹è¯•é€šè¿‡ |
| AC-012 | æµ‹è¯•æ¡†æ¶å¯è¿è¡Œ | infrastructure.bats | `AC-012: Makefile å­˜åœ¨` | âœ… PASS | Makefile éªŒè¯é€šè¿‡ |

### çŠ¶æ€è¯´æ˜

- âœ… PASSï¼šæµ‹è¯•é€šè¿‡
- ğŸ”´ FAILï¼šæµ‹è¯•å¤±è´¥ï¼ˆé¢„æœŸçš„ Red åŸºçº¿ï¼‰
- ğŸŸ¡ SKIPï¼šæµ‹è¯•è·³è¿‡ï¼ˆç¯å¢ƒä¾èµ–ï¼‰
- ğŸŸ¡ PARTIALï¼šéƒ¨åˆ†é€šè¿‡

---

## C) æ‰§è¡Œé”šç‚¹

### æ‰§è¡Œå‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# ä»…è¿è¡Œ shellcheck
make lint

# æ£€æŸ¥ --help æ”¯æŒ
make help-check

# å•ç‹¬è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
bats tests/harden-devbooks-quality-gates/change-check.bats
```

### CI é›†æˆ

æµ‹è¯•å°†åœ¨ä»¥ä¸‹é˜¶æ®µè‡ªåŠ¨æ‰§è¡Œï¼š

1. **PR æäº¤æ—¶**ï¼š`make lint` + `make test`
2. **åˆå¹¶å‰**ï¼šå®Œæ•´æµ‹è¯•å¥—ä»¶
3. **æ¯æ—¥å®šæ—¶**ï¼šå›å½’æµ‹è¯•

---

## D) MANUAL-* æ¸…å•

| ID | æ‰‹å·¥éªŒè¯é¡¹ | éªŒè¯æ–¹æ³• | éªŒè¯äºº | çŠ¶æ€ |
|----|-----------|----------|--------|------|
| MANUAL-001 | AC-011 å®¡è®¡ç²¾åº¦éªŒè¯ | æ‰‹å·¥æŠ½æ · 10 ä¸ªæ–‡ä»¶å¯¹æ¯” | TBD | å¾…æ‰§è¡Œ |
| MANUAL-002 | AC-003 Coder è§’è‰²è¾¹ç•Œæ£€æŸ¥ | åœ¨ git ä»“åº“ä¸­æ¨¡æ‹Ÿ Coder ä¿®æ”¹ tests/ æ–‡ä»¶ï¼ŒéªŒè¯ change-check.sh æ‹¦æˆª | TBD | å¾…æ‰§è¡Œ |

**è¯´æ˜**ï¼š
- AC-011 çš„ç²¾åº¦éªŒè¯éœ€è¦äººå·¥æŠ½æ ·å¯¹æ¯”ï¼Œæ— æ³•å®Œå…¨è‡ªåŠ¨åŒ–ã€‚
- AC-003 éœ€è¦çœŸå® git ç¯å¢ƒéªŒè¯è§’è‰²è¾¹ç•Œï¼Œå•å…ƒæµ‹è¯•å·² skipï¼Œéœ€é›†æˆæµ‹è¯•æˆ–æ‰‹å·¥éªŒè¯ã€‚

### MANUAL-002 éªŒè¯æ­¥éª¤

```bash
# 1. åˆ›å»ºæµ‹è¯•åˆ†æ”¯
git checkout -b test-ac003-role-boundary

# 2. æ¨¡æ‹Ÿ Coder ä¿®æ”¹ tests/ æ–‡ä»¶
echo "# test" >> tests/harden-devbooks-quality-gates/change-check.bats
git add tests/

# 3. è¿è¡Œè§’è‰²è¾¹ç•Œæ£€æŸ¥
./skills/devbooks-delivery-workflow/scripts/change-check.sh <change-id> \
    --mode apply \
    --role coder

# 4. é¢„æœŸç»“æœï¼šè¿”å›éé›¶é€€å‡ºç ï¼Œè¾“å‡ºåŒ…å« "è§’è‰²è¿è§„" æˆ– "tests/"

# 5. æ¸…ç†
git checkout -- tests/
git checkout master
git branch -D test-ac003-role-boundary
```

---

## æµ‹è¯•ç¯å¢ƒå£°æ˜

- è¿è¡Œç¯å¢ƒï¼šmacOS 14+ / Linux (Ubuntu 22.04+)
- Shellï¼šBash 3.2+ / Zsh 5.0+
- å¿…è¦ä¾èµ–ï¼š
  - `bats` >= 1.0.0
  - `shellcheck` >= 0.8.0
  - `ripgrep` (`rg`)
  - `git`
  - `jq`ï¼ˆå¯é€‰ï¼‰
- æ•°æ®åº“ï¼šN/A
- å¤–éƒ¨ä¾èµ–ï¼šæ— 

### ç¯å¢ƒæ£€æŸ¥å‘½ä»¤

```bash
# æ£€æŸ¥ä¾èµ–
command -v bats && bats --version
command -v shellcheck && shellcheck --version
command -v rg && rg --version
command -v git && git --version
```

---

## E) Red åŸºçº¿è®°å½•

### å»ºç«‹æ—¶é—´

2026-01-11

### é¢„æœŸå¤±è´¥æµ‹è¯•

ä»¥ä¸‹æµ‹è¯•åœ¨ Red åŸºçº¿é˜¶æ®µåº”è¯¥å¤±è´¥ï¼š

| æµ‹è¯• | å¤±è´¥åŸå›  |
|------|----------|
| AC-001 ç³»åˆ— | `check_evidence_closure()` å‡½æ•°å°šæœªå®ç° |
| AC-004 ç³»åˆ— | `handoff-check.sh` è„šæœ¬å°šæœªåˆ›å»º |
| AC-005 ç³»åˆ— | `check_skip_approval()` å‡½æ•°å°šæœªå®ç° |
| AC-006 ç³»åˆ— | `env-match-check.sh` è„šæœ¬å°šæœªåˆ›å»º |
| AC-007 ç³»åˆ— | Green è¯æ®å¤±è´¥æ£€æµ‹å°šæœªå®ç° |
| AC-009 ç³»åˆ— | æ–°è„šæœ¬å°šæœªåˆ›å»º |
| AC-010 ç³»åˆ— | `progress-dashboard.sh` è„šæœ¬å°šæœªåˆ›å»º |
| AC-011 ç³»åˆ— | `audit-scope.sh` è„šæœ¬å°šæœªåˆ›å»º |
| è¿ç§»è„šæœ¬ç³»åˆ— | `migrate-to-v2-gates.sh` è„šæœ¬å°šæœªåˆ›å»º |

### è¯æ®è½ç‚¹

- Red åŸºçº¿æ—¥å¿—ï¼š`openspec/changes/harden-devbooks-quality-gates/evidence/red-baseline/test-results.log`
- æµ‹è¯•è¾“å‡ºæ‘˜è¦ï¼š`openspec/changes/harden-devbooks-quality-gates/evidence/red-baseline/summary.md`

---

## F) Green éªŒæ”¶æ ‡å‡†

å½“ä»¥ä¸‹æ¡ä»¶å…¨éƒ¨æ»¡è¶³æ—¶ï¼Œè§†ä¸º Greenï¼š

1. [ ] `make test` è¿”å›é›¶é€€å‡ºç ï¼ˆæ‰€æœ‰ BATS æµ‹è¯•é€šè¿‡ï¼‰
2. [ ] `make lint` è¿”å›é›¶é€€å‡ºç ï¼ˆæ‰€æœ‰è„šæœ¬é€šè¿‡ shellcheckï¼‰
3. [ ] `make help-check` è¿”å›é›¶é€€å‡ºç ï¼ˆæ‰€æœ‰è„šæœ¬æ”¯æŒ --helpï¼‰
4. [ ] AC-001 è‡³ AC-012 å…¨éƒ¨é€šè¿‡
5. [ ] MANUAL-001 äººå·¥éªŒè¯å®Œæˆ

---

## G) ä»·å€¼æµä¸åº¦é‡

### ç›®æ ‡ä»·å€¼ä¿¡å·

| ä¿¡å· | åŸºçº¿å€¼ | ç›®æ ‡å€¼ | è§‚æµ‹æ–¹å¼ |
|------|--------|--------|----------|
| å‡å®Œæˆç‡ | ~40% | < 5% | `change-check.sh --mode archive` å¤±è´¥ç‡ |
| è§’è‰²æ–­æ¡£ç‡ | ~30% | 0% | `handoff.md` å­˜åœ¨ä¸”æœ‰åŒæ–¹ç­¾å |
| ä»»åŠ¡è·³è¿‡æœªå®¡æ‰¹ç‡ | ~50% | 0% | P0 è·³è¿‡æ—  `SKIP-APPROVED` æ³¨é‡Š |
| å®¡è®¡ä½ä¼°å€æ•° | 2-13x | < 1.5x | `audit-scope.sh` ä¸æ‰‹å·¥æŠ½æ ·å¯¹æ¯” |

### åº¦é‡æ–¹æ³•

1. **å‡å®Œæˆç‡**ï¼šç»Ÿè®¡ archive æ¨¡å¼å› è¯æ®ç¼ºå¤±è€Œå¤±è´¥çš„æ¬¡æ•° / æ€» archive å°è¯•æ¬¡æ•°
2. **è§’è‰²æ–­æ¡£ç‡**ï¼šç»Ÿè®¡æ— æœ‰æ•ˆ handoff.md çš„å˜æ›´åŒ…æ•° / æ€»å˜æ›´åŒ…æ•°
3. **ä»»åŠ¡è·³è¿‡æœªå®¡æ‰¹ç‡**ï¼šç»Ÿè®¡ P0 è·³è¿‡æ— å®¡æ‰¹çš„æ¬¡æ•° / æ€» P0 è·³è¿‡æ¬¡æ•°
4. **å®¡è®¡ä½ä¼°å€æ•°**ï¼šaudit-scope.sh è¾“å‡º / æ‰‹å·¥è®¡æ•°

---

## H) Test Owner æ£€æŸ¥æ¸…å•

åœ¨äº¤æ¥ç»™ Coder å‰ï¼Œç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

- [x] æµ‹è¯•æ–‡ä»¶å·²åˆ›å»ºï¼ˆ6 ä¸ª .bats æ–‡ä»¶ï¼‰
- [x] test_helper.bash å·²é…ç½®
- [x] Makefile å·²åˆ›å»º
- [x] è¿½æº¯çŸ©é˜µå·²å¡«å†™
- [x] Red åŸºçº¿æµ‹è¯•å·²è¿è¡Œ
- [x] å¤±è´¥è¯æ®å·²è½ç›˜åˆ° evidence/red-baseline/
- [x] æµ‹è¯•ç¯å¢ƒå£°æ˜å·²å¡«å†™
- [ ] ä¸ Coder ç¡®è®¤äº¤æ¥ï¼ˆå¾…åˆ›å»º handoff.mdï¼‰

---

**æ–‡æ¡£ç»“æŸ**
