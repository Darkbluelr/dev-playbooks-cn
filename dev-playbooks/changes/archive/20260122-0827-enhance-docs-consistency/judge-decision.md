# 提案裁决报告

**变更包**：20260122-0827-enhance-docs-consistency
**裁决时间**：2026-01-22
**裁决者**：AI (devbooks-proposal-judge)

---

## 1. 裁决结论

**Approved** - 提案通过，可进入设计阶段。

**理由**：
1. 本项目为文档项目，不涉及复杂代码实现
2. 所有目标功能相互关联，整体实现合理
3. 提案结构完整，包含必要的影响分析和风险评估
4. 用户明确要求在单个变更包中完成

---

## 2. 需要在设计阶段补充的内容

### 2.1 验收标准（AC）

提案中缺少明确的 AC-xxx 格式验收标准，需在 design.md 中补充：

**AC-001：改名与别名机制**
- 改名后 `devbooks-docs-consistency` 可正常调用
- 别名 `devbooks-docs-sync` 保留 6 个月
- 别名调用时显示废弃警告

**AC-002：自定义规则支持**
- 支持命令行参数 `--once "remove:@augment"`
- 支持配置文件持久化规则
- 规则语法清晰，易于理解

**AC-003：增量扫描机制**
- 基于 git diff 判断变更范围
- 新增文件触发相关文档检查
- 删除文件触发引用清理
- 增量扫描失败自动回退全量扫描

**AC-004：完备性检查维度**
- 环境依赖：检查环境变量、系统依赖
- 安全权限：检查文件权限、执行权限
- 故障排查：检查错误处理、日志记录
- 配置完整性：检查配置项文档

**AC-005：文档风格偏好**
- 优先级：命令行参数 > 配置文件 > 默认值
- 支持 `use_emoji`、`use_fancy_words` 等配置
- 违反风格偏好时给出警告

**AC-006：浮夸词语判定**
- 使用白名单机制保留技术术语
- 提供预览功能，批量修改前确认
- 支持回滚误删内容

**AC-007：专家角色声明**
- skill 定义 `recommended_experts` 列表
- AI 执行前必须声明扮演的专家
- 未定义专家列表时使用通用专家

### 2.2 增量扫描算法

需在 design.md 中明确：
1. 如何确定扫描范围（基于 git diff）
2. 边界场景处理（新增/删除/重命名文件）
3. 回退触发条件（增量扫描失败）
4. Token 消耗基线和预期节省率

### 2.3 文档分类定义

需在 design.md 中补充：
1. 活体文档：与代码同步更新的文档（README、API 文档）
2. 历史文档：不再更新的文档（CHANGELOG、归档文档）
3. 概念性文档：方法论、指南类文档
4. 不同分类的处理策略

### 2.4 自定义规则配置格式

需在 design.md 中提供：
1. 规则配置示例（YAML 格式）
2. 规则语法说明
3. 规则优先级和冲突处理
4. 规则验证机制

### 2.5 风险缓解措施细化

需在 design.md 中补充：

**改名风险**：
- 别名实现方式：符号链接或配置映射
- 废弃通知：日志警告 + 文档说明
- 迁移指南位置：`docs/migration.md`

**增量扫描遗漏风险**：
- 检测方式：对比增量和全量结果
- 回退触发：检测到遗漏或扫描失败
- 通知方式：日志记录 + 用户提示

**元数据维护负担**：
- 自动维护：扫描时自动更新 `last_full_scan`
- 手动调整：用户可编辑 `style_preferences`
- 验证机制：schema 验证 + 格式检查

### 2.6 回滚策略完善

需在 design.md 中定义：
1. 回滚粒度：整体回滚 vs 部分回滚
2. 回滚前置条件：哪些情况下可以回滚
3. 数据一致性：回滚后如何处理依赖关系
4. 回滚脚本或命令

### 2.7 集成接口定义

需在 design.md 中补充：
1. 其他 skills 如何调用 `devbooks-docs-consistency`
2. 调用参数和返回值
3. 集成失败处理

### 2.8 文档扫描范围与排除规则

需在 design.md 中明确：
1. **扫描范围**：哪些目录和文件需要检查
2. **排除规则**：明确排除用户项目中的 `dev-playbooks/` 目录
   - 理由：这些文件是通过 `devbooks init` 创建的模板文件
   - 这些模板由 DevBooks 工具自身维护
   - 面向开发者使用，不面向最终用户
   - 用户项目的文档一致性由用户自己负责
3. **配置方式**：如何在 `docs-maintenance.md` 中配置排除规则
4. **默认排除列表**：除了 `dev-playbooks/`，还应排除哪些目录（如 `node_modules/`、`.git/` 等）

---

## 3. 非阻断建议

### 3.1 改名理由

建议在 design.md 中明确工具的核心职责：
- 如果主要职责是"检查一致性"，改名合理
- 如果主要职责是"同步更新文档"，保留原名更合适

### 3.2 元数据文件位置

建议考虑将 `docs-maintenance.md` 放在：
- `dev-playbooks/_meta/`（更符合元数据定位）
- 或在 design.md 中说明为什么放在 `specs/_meta/`

### 3.3 完备性思维框架位置

建议考虑将完备性思维框架放在：
- `dev-playbooks/docs/`（通用方法论文档）
- 或在 design.md 中说明为什么放在 `skills/_shared/references/`

### 3.4 Debate Packet 问题

提案中列出了 9 个需要决策的问题，建议在设计阶段前解决：
1. 改名策略：推荐选项 A（提供别名）
2. 规则引擎复杂度：推荐选项 A（完整规则引擎 + 零配置默认）
3. 增量扫描触发时机：推荐选项 B（自动判断）
4. 元数据维护方式：推荐选项 B（自动为主，可手动调整）
5. 完备性检查严格程度：推荐选项 B（只警告）
6. 共享方法论文档位置：推荐选项 A
7. Challenger 审视部分实现：推荐选项 A
8. 浮夸词语去除范围：推荐选项 A
9. MCP 增强功能处理：推荐选项 A

---

## 4. 证据缺口

### 4.1 增量扫描 Token 节省

**缺失证据**：
- 当前全量扫描的 token 消耗基线
- 增量扫描的预期 token 消耗
- 如何测量和验证 90% 的节省率

**建议**：
1. 在设计阶段收集当前 token 消耗数据
2. 在实现阶段验证增量扫描的实际节省率
3. 如果节省不明显，考虑调整目标

### 4.2 浮夸词语判定标准

**缺失证据**：
- 如何判断一个词语是否"浮夸"
- 如何避免误删技术术语
- 如何处理上下文相关的词语

**建议**：
1. 提供白名单机制（保留的技术术语）
2. 提供上下文检查（避免误删）
3. 提供人工审核机制（批量修改前预览）

### 4.3 专家角色声明强制性

**缺失证据**：
- 如何强制 AI 执行角色声明
- 如果 AI 跳过角色声明，如何检测和阻止
- 如果 skill 没有定义 `recommended_experts`，如何处理

**建议**：
1. 在 skill 执行前添加检查点
2. 提供默认专家列表
3. 在 AI 行为规范中明确违反规则的后果

---

## 5. 风险评估

### 5.1 可接受的风险

| 风险 | 概率 | 影响 | 缓解措施 | 评估 |
|------|------|------|----------|------|
| 改名后用户无法找到工具 | 中 | 中 | 提供别名 | ✓ 可接受 |
| 元数据维护成为负担 | 中 | 中 | 自动维护 | ✓ 可接受 |
| 规则引擎过于复杂 | 中 | 中 | 零配置默认行为 | ✓ 可接受 |
| 完备性检查过于严格 | 低 | 低 | 提供检查级别配置 | ✓ 可接受 |
| 去除词语影响理解 | 低 | 低 | 保留核心描述 | ✓ 可接受 |

### 5.2 需要关注的风险

| 风险 | 概率 | 影响 | 建议 |
|------|------|------|------|
| 增量扫描遗漏新增代码 | 低 | 高 | 在设计阶段明确回退机制 |
| 增量扫描无法节省 token | 中 | 中 | 在实现阶段验证实际效果 |
| 自定义规则过于复杂 | 中 | 中 | 先支持简单规则，后续迭代 |
| 浮夸词语误删 | 低 | 中 | 提供预览和回滚机制 |
| 专家角色声明无法强制 | 中 | 低 | 在 AI 行为规范中明确约束 |

---

## 6. 下一步行动

### 6.1 立即行动

1. **更新 Decision Status**：
   ```markdown
   - **Decision Status**: `Approved`
   - **Decision summary**: 提案通过，进入设计阶段
   - **Conditions**: 需在 design.md 中补充 AC、算法、配置格式等内容
   ```

2. **运行 devbooks-design-doc**：
   ```bash
   devbooks-design-doc 20260122-0827-enhance-docs-consistency
   ```

### 6.2 设计阶段重点

1. 补充完整的 AC-xxx 列表
2. 明确增量扫描算法和边界条件
3. 定义文档分类标准
4. 提供自定义规则配置示例
5. 细化风险缓解措施
6. 完善回滚策略
7. 定义集成接口

### 6.3 实现阶段验证

1. 收集 token 消耗基线数据
2. 验证增量扫描实际节省率
3. 测试浮夸词语判定准确性
4. 验证专家角色声明机制

---

## 7. 总结

**核心优势**：
1. 提案结构完整，包含必要的影响分析和风险评估
2. 目标明确，功能相互关联
3. 适合文档项目，不涉及复杂代码实现
4. 用户明确要求整体实现

**需要改进**：
1. 补充明确的验收标准（AC-xxx）
2. 细化增量扫描算法和边界条件
3. 提供自定义规则配置示例
4. 完善风险缓解措施和回滚策略
5. 收集证据验证关键假设

**裁决依据**：
- 遵循 GIP-03（Design First）：提案包含必要的设计元素
- 遵循可验证性守门协议：关键结论有证据支撑（部分需在设计阶段补充）
- 遵循用户意图：尊重用户关于变更包范围的决策

**批准条件**：
- 在设计阶段补充上述缺失内容
- 在实现阶段验证关键假设
- 在测试阶段确保质量闸门通过

---

**签名**：AI (devbooks-proposal-judge)
**日期**：2026-01-22
